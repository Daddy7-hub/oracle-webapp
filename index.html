<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>CryptoATM.tech ‚Äî –ü–æ–¥–ø–∏—Å–∫–∏</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0b0b0d; --panel:#111214; --card:#15161a; --muted:#9ba0ad; --txt:#f6f7fb;
    --gold:#ffd86b; --gold2:#e6c252; --accent:#7c4dff; --danger:#ff6a88; --ok:#27e1a7;
    --bd:1px solid rgba(255,255,255,.06); --bd2:1px dashed rgba(255,255,255,.14);
    --r12:12px; --r16:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 70% -100px,rgba(255,216,107,.12),transparent),var(--bg);color:var(--txt);font:15px/1.45 system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
  a{color:var(--gold)}
  .wrap{max-width:1040px;margin:0 auto;padding:14px 14px 120px}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(11,11,13,.95),rgba(11,11,13,.7));backdrop-filter:blur(6px)}
  .brand{display:flex;align-items:center;gap:12px;padding:12px 14px;border:var(--bd);border-radius:16px;background:linear-gradient(180deg,rgba(255,216,107,.08),rgba(255,216,107,.02));box-shadow:var(--shadow)}
  .logo{width:42px;height:42px;border-radius:12px;background:radial-gradient(circle at 30% 30%,#fff7d1,#e3c65a 40%,#b9962e 65%,#5b4a18 90%);box-shadow:inset 0 0 0 1px rgba(0,0,0,.35)}
  .brand h1{margin:0;font-size:18px;letter-spacing:.3px}
  .brand p{margin:0;color:var(--muted);font-size:12px}
  .chips{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:flex;gap:8px;align-items:center;padding:6px 10px;background:rgba(255,255,255,.06);border:var(--bd);border-radius:999px}
  .nav{display:flex;gap:8px;margin:12px 0}
  .tab{flex:1 1 auto;display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border-radius:14px;border:var(--bd);background:#121316;font-weight:800;cursor:pointer}
  .tab.active{background:linear-gradient(135deg,rgba(255,216,107,.22),rgba(124,77,255,.18));border-color:rgba(255,216,107,.45)}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}
  @media(max-width:980px){.col-8,.col-6,.col-4{grid-column:span 12}}
  .card{background:var(--card);border:var(--bd);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
  .card h3{margin:0 0 6px}
  .muted{color:var(--muted)}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:var(--bd);background:rgba(255,255,255,.04);font-weight:800;font-size:12px}
  .btn{appearance:none;border:0;border-radius:14px;padding:12px 14px;font-weight:900;cursor:pointer;transition:transform .05s ease}
  .btn:active{transform:translateY(1px)}
  .btn.gold{background:linear-gradient(180deg,var(--gold),var(--gold2));color:#1b1402}
  .btn.ghost{background:transparent;border:var(--bd2);color:var(--txt)}
  .btn.warn{background:linear-gradient(180deg,#ffb1c0,#ff7994);color:#2b0b12}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .line{display:flex;align-items:center;justify-content:space-between;border-top:var(--bd2);padding-top:10px;margin-top:10px}
  .price{font-weight:900;color:var(--gold)}
  select,input{width:100%;padding:12px 12px;border-radius:12px;border:var(--bd);background:#111317;color:var(--txt)}
  .details{margin-top:10px;border-top:var(--bd2);padding-top:10px;color:#dfe2ea}
  .sticky-cart{position:fixed;left:0;right:0;bottom:0;z-index:20;background:linear-gradient(180deg,rgba(11,11,13,.05),rgba(11,11,13,.85) 25%,rgba(11,11,13,.95));padding:10px 12px;border-top:var(--bd)}
  .cartbar{max-width:1040px;margin:0 auto;display:flex;gap:10px;align-items:center}
  .cartbar .tot{font-weight:900}
  .cart-items{max-height:180px;overflow:auto;border:var(--bd);border-radius:12px;padding:8px;background:#0f1013}
  .cart-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,.08)}
  .cart-item:last-child{border-bottom:0}
  .badge{padding:4px 7px;border-radius:10px;background:rgba(255,216,107,.18);border:1px solid rgba(255,216,107,.45);color:#ffeaa2;font-size:12px;font-weight:900}
  .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.14),transparent);margin:10px 0}
  .nowrap{white-space:nowrap}
  dialog{border:0;border-radius:16px;padding:0;background:#0f1114;color:var(--txt);max-width:560px;box-shadow:var(--shadow)}
  dialog::backdrop{background:rgba(0,0,0,.6);backdrop-filter:blur(3px)}
  .modal{padding:16px}
  .modal h3{margin:0 0 6px}
  .modal .footer{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .qr{width:160px;height:160px;border-radius:12px;background:#fff;margin:6px 0;align-self:center}
  .copy{font-size:12px;color:var(--muted);user-select:all}
  .toast{position:fixed;bottom:84px;left:50%;transform:translateX(-50%);background:#14161a;border:var(--bd);border-radius:999px;padding:10px 14px;box-shadow:var(--shadow);display:none}
  .hide-mobile{display:block}
  @media(max-width:560px){ .hide-mobile{display:none} .chip{font-size:12px} .btn{padding:13px 14px} }
</style>
</head>
<body>
<header class="wrap">
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>CRYPTOATM.TECH</h1>
      <p>–ü–æ–¥–ø–∏—Å–∫–∏ ‚Ä¢ –ü–∞–∫–µ—Ç—ã ‚Ä¢ –û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π/–ø–æ —Å—á–µ—Ç—É</p>
    </div>
    <div class="chips">
      <div class="chip"><b id="u-name">@guest</b></div>
      <div class="chip">–ö–æ—Ä–∑–∏–Ω–∞: <b id="u-cart">0</b></div>
    </div>
  </div>

  <div class="nav">
    <button class="tab active" data-tab="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="tab" data-tab="orders">üìÑ –ó–∞–∫–∞–∑—ã</button>
    <button class="tab" data-tab="faq">‚ùì FAQ</button>
  </div>
</header>

<div class="wrap">
  <!-- notice -->
  <div class="card col-12" style="margin-bottom:10px">
    <div class="row" style="justify-content:space-between;gap:10px">
      <div>
        <div class="pill">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äî —Å–∫–∏–¥–∫–∞ 10%/20% –Ω–∞ 3/6 –º–µ—Å</div>
        <div class="hr"></div>
        <div class="row">
          <div style="min-width:220px">
            <label class="muted">–°—Ä–æ–∫</label>
            <select id="term" onchange="updatePrices()">
              <option value="1">1 –º–µ—Å—è—Ü</option>
              <option value="3">3 –º–µ—Å—è—Ü–∞ (-10%)</option>
              <option value="6">6 –º–µ—Å—è—Ü–µ–≤ (-20%)</option>
            </select>
          </div>
          <div style="min-width:220px">
            <label class="muted">–í–∞–ª—é—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
            <select id="currency" onchange="updateCartUI()">
              <option value="EUR">EUR</option>
              <option value="USDT">USDT (—ç–∫–≤.)</option>
            </select>
          </div>
        </div>
      </div>
      <div class="row hide-mobile" style="align-items:flex-end">
        <button class="btn ghost" onclick="openModal('aboutModal')">–û –ø—Ä–æ–µ–∫—Ç–µ</button>
        <button class="btn ghost" onclick="openModal('disclaimerModal')">–î–∏—Å–∫–ª–µ–π–º–µ—Ä</button>
      </div>
    </div>
  </div>

  <!-- SHOP -->
  <section id="tab-shop" class="grid">
    <div class="col-12">
      <div id="catalog" class="grid"></div>
    </div>
  </section>

  <!-- ORDERS -->
  <section id="tab-orders" class="grid" hidden>
    <div class="col-12 card">
      <h3>–í–∞—à–∏ –∑–∞–∫–∞–∑—ã</h3>
      <div id="orders" class="muted">–ù–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (–¥–µ–º–æ).</div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="tab-faq" class="grid" hidden>
    <div class="col-12 card">
      <h3>FAQ</h3>
      <ul class="muted">
        <li>–í—ã –º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å —Å–≤–æ–π –Ω–∞–±–æ—Ä –±–æ—Ç–æ–≤ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –ø–∞–∫–µ—Ç—ã Premium/Enterprise.</li>
        <li>–°—Ä–æ–∫–∏ 1/3/6 –º–µ—Å ‚Äî —á–µ–º –¥–ª–∏–Ω–Ω–µ–µ —Å—Ä–æ–∫, —Ç–µ–º –±–æ–ª—å—à–µ —Å–∫–∏–¥–∫–∞.</li>
        <li>–û–ø–ª–∞—Ç–∞: USDT (–∫—Ä–∏–ø—Ç–∞) –∏–ª–∏ –±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —é—Ä–ª–∏—Ü–æ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏).</li>
        <li>–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø—ã; —Å—Ç–∞—Ç—É—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ ‚Äú–ó–∞–∫–∞–∑—ã‚Äù.</li>
      </ul>
    </div>
  </section>
</div>

<!-- STICKY CART -->
<div class="sticky-cart">
  <div class="cartbar">
    <div class="badge">–ö–æ—Ä–∑–∏–Ω–∞</div>
    <div class="cart-items" id="cart-list" style="flex:1">–ü—É—Å—Ç–æ</div>
    <div class="row">
      <div class="tot">–ò—Ç–æ–≥–æ: <span class="price"><span id="cart-total">‚Ç¨0</span></span></div>
      <button class="btn ghost" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
      <button class="btn gold" onclick="openModal('checkoutModal')">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<dialog id="checkoutModal">
  <div class="modal">
    <h3>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h3>
    <p class="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã. –°—É–º–º–∞ –∏ —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ –Ω–∏–∂–µ.</p>
    <div id="checkout-summary" class="card" style="margin-top:8px"></div>

    <div class="row" style="margin-top:10px">
      <button class="btn gold" onclick="choosePay('crypto')">–û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
      <button class="btn gold" onclick="choosePay('bank')">–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ —Å—á–µ—Ç—É</button>
      <button class="btn ghost" onclick="closeModal('checkoutModal')">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</dialog>

<!-- CRYPTO MODAL -->
<dialog id="cryptoModal">
  <div class="modal">
    <h3>–û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π (USDT)</h3>
    <div class="pill">TRC20 / BEP20 / ERC20 ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ç—å</div>
    <div class="row" style="margin-top:8px">
      <select id="net" style="max-width:200px">
        <option value="TRC20">TRC20</option>
        <option value="BEP20">BEP20</option>
        <option value="ERC20">ERC20</option>
      </select>
      <button class="btn ghost" onclick="copyText('pay-amount')">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É</button>
    </div>
    <div class="hr"></div>
    <div class="row">
      <div style="flex:1">
        <div class="muted">–ê–¥—Ä–µ—Å –¥–ª—è USDT</div>
        <div class="copy" id="pay-address">0x5af48f9d26edb82e7c30247e105fbf61d2dd1a5c</div>
        <div class="muted" style="margin-top:6px">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ</div>
        <div class="copy" id="pay-amount">0</div>
      </div>
      <canvas class="qr" id="qr"></canvas>
    </div>
    <div class="hr"></div>
    <p class="muted">–ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ ‚Äú–Ø –æ–ø–ª–∞—Ç–∏–ª‚Äù. –ú—ã —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º –ø–µ—Ä–µ–≤–æ–¥ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫–∏.</p>
    <div class="footer">
      <button class="btn ghost" onclick="closeModal('cryptoModal')">–ù–∞–∑–∞–¥</button>
      <button class="btn gold" onclick="confirmPaid('crypto')">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
    </div>
  </div>
</dialog>

<!-- BANK MODAL -->
<dialog id="bankModal">
  <div class="modal">
    <h3>–û–ø–ª–∞—Ç–∞ –ø–æ —Å—á–µ—Ç—É (–±–∞–Ω–∫)</h3>
    <p class="muted">–†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ FANARI O√ú (–ø—Ä–∏–º–µ—Ä). –ü—Ä–∏—à–ª—ë–º —Å—á—ë—Ç –Ω–∞ email/Telegram.</p>
    <div class="card">
      <div><b>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</b> FANARI O√ú</div>
      <div><b>IBAN:</b> EE12 2200 2211 0000 123</div>
      <div><b>BIC:</b> HABAEE2X</div>
      <div><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> –ü–æ–¥–ø–∏—Å–∫–∞ CryptoATM, –∑–∞–∫–∞–∑ <span id="bank-order-id">‚Äî</span></div>
      <div><b>–°—É–º–º–∞:</b> <span id="bank-amount">‚Ç¨0</span></div>
    </div>
    <div class="footer">
      <button class="btn ghost" onclick="closeModal('bankModal')">–ù–∞–∑–∞–¥</button>
      <button class="btn gold" onclick="confirmPaid('bank')">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
    </div>
  </div>
</dialog>

<!-- ABOUT MODAL -->
<dialog id="aboutModal">
  <div class="modal">
    <h3>–û —Å–µ—Ä–≤–∏—Å–µ</h3>
    <p class="muted">CryptoATM.tech ‚Äî –Ω–∞–±–æ—Ä Telegram-–±–æ—Ç–æ–≤ –∏ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –∏ –Ω–æ–≤–æ—Å—Ç–µ–π. –í —ç—Ç–æ–º –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π –∏–ª–∏ –ø–æ —Å—á–µ—Ç—É.</p>
    <div class="footer"><button class="btn gold" onclick="closeModal('aboutModal')">–ü–æ–Ω—è—Ç–Ω–æ</button></div>
  </div>
</dialog>

<!-- DISCLAIMER (first run) -->
<dialog id="disclaimerModal">
  <div class="modal">
    <h3>–í–∞–∂–Ω–æ: –¥–∏—Å–∫–ª–µ–π–º–µ—Ä</h3>
    <p class="muted">
      –ò—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ä–≤–∏—Å CryptoATM.tech, –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ <b>–Ω–µ</b> —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. 
      –†—ã–Ω–æ–∫ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω, –±–æ—Ç—ã –∏ —Å–∏–≥–Ω–∞–ª—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫–∏. –ú—ã –Ω–µ –æ—Ç–≤–µ—á–∞–µ–º –∑–∞ –≤–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞.
      –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ª—è—Ö; –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –ª–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑.
    </p>
    <div class="footer">
      <button class="btn warn" onclick="declineDisclaimer()">–ù–µ –ø—Ä–∏–Ω–∏–º–∞—é</button>
      <button class="btn gold" onclick="acceptDisclaimer()">–Ø –ø–æ–Ω–∏–º–∞—é –∏ –ø—Ä–∏–Ω–∏–º–∞—é</button>
    </div>
  </div>
</dialog>

<div class="toast" id="toast"></div>

<script>
/* ---------------------- DATA ---------------------- */
const tg = window.Telegram?.WebApp;
if (tg) tg.expand();

const EUR_USDT = 1.00; // –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞
const GOODS = [
  // INDIVIDUAL BOTS (—Ü–µ–Ω—ã –∑–∞ 1 –º–µ—Å—è—Ü, EUR)
  { id:'cryptoatm', type:'bot',   name:'Crypto ATM Bot',    price:71,  badge:'–ë–æ—Ç',    short:'BTC-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —É—Ä–æ–≤–Ω–∏, —Å–∏–≥–Ω–∞–ª—ã.', details:'–ö–∏—Ç—ã, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, funding, OI, –æ–±—ä—ë–º—ã, —É—Ä–æ–≤–Ω–∏. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.' },
  { id:'alerts',    type:'bot',   name:'Alerts Bot',        price:39,  badge:'–ë–æ—Ç',    short:'–ê–ª–µ—Ä—Ç—ã –ø–æ —Ä—ã–Ω–∫—É 24/7.',             details:'–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã, —Ñ–∏–ª—å—Ç—Ä –¥—É–±–ª–µ–π, –≥–∏–±–∫–∏–µ –ø–æ—Ä–æ–≥–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.' },
  { id:'news',      type:'bot',   name:'News & Events Bot', price:29,  badge:'–ë–æ—Ç',    short:'–ù–æ–≤–æ—Å—Ç–∏, —Å–æ–±—ã—Ç–∏—è, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.',     details:'CoinMarketCal, RSS, –ø–µ—Ä–µ–≤–æ–¥, —Ç–æ–ø-3, –¥–∞–π–¥–∂–µ—Å—Ç—ã, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.' },
  // PACKS (–≤—ã–≥–æ–¥–Ω–µ–µ)
  { id:'premium',   type:'pack',  name:'Premium (–≤—Å–µ –±–æ—Ç—ã)', price:89, badge:'–ü–∞–∫–µ—Ç',  short:'–í—Å–µ –±–æ—Ç—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–Ω–æ–π —Ü–µ–Ω–µ.',        details:'–í–∫–ª—é—á–∞–µ—Ç Crypto ATM, Alerts, News. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞.' },
  { id:'enterprise',type:'pack',  name:'Enterprise',         price:149,badge:'–ü–∞–∫–µ—Ç',  short:'–í—Å–µ –±–æ—Ç—ã + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã.',     details:'–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.' },
];

const state = {
  user: { id: tg?.initDataUnsafe?.user?.id || 0, username: tg?.initDataUnsafe?.user?.username || 'guest' },
  term: 1, currency:'EUR',
  cart: [],
  orders: []
};

/* ---------------------- HELPERS ---------------------- */

function $(sel){ return document.querySelector(sel); }
function el(tag, attrs={}, html=''){ const n=document.createElement(tag); for(const k in attrs) n.setAttribute(k, attrs[k]); n.innerHTML=html; return n; }
function toast(msg){ const t=$("#toast"); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none', 1800); }

function sendData(obj){ // –∫ –±—ç–∫—É —á–µ—Ä–µ–∑ Telegram
  const payload = JSON.stringify(obj);
  if (tg && typeof tg.sendData === 'function'){ tg.sendData(payload); }
  else console.log('[offline send]', payload);
}

/* ---------------------- PRICING ---------------------- */

function termMultiplier(months){
  if (months==3) return 0.9;
  if (months==6) return 0.8;
  return 1.0;
}
function priceFor(item){
  return Math.round(item.price * termMultiplier(state.term) * state.term);
}
function fmtMoney(eur){
  if (state.currency==='EUR') return '‚Ç¨'+eur;
  const usdt = (eur*EUR_USDT).toFixed(2);
  return usdt+' USDT';
}

/* ---------------------- RENDER: CATALOG ---------------------- */

function renderCatalog(){
  const holder = $("#catalog"); holder.className='grid'; holder.innerHTML='';
  GOODS.forEach(item=>{
    const col = el('div', {class:'col-6'});
    const card = el('div', {class:'card'});
    card.innerHTML = `
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div>
          <div class="pill">${item.badge}</div>
          <h3 style="margin-top:6px">${item.name}</h3>
          <div class="muted">${item.short}</div>
        </div>
        <div class="price nowrap">${fmtMoney(priceFor(item))} / —Å—Ä–æ–∫</div>
      </div>
      <div class="details" id="details-${item.id}" hidden>${item.details}</div>
      <div class="line">
        <div class="row">
          <button class="btn ghost" onclick="toggleDetails('${item.id}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
        </div>
        <div class="row">
          <button class="btn gold" onclick="addToCart('${item.id}')">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      </div>
    `;
    col.appendChild(card);
    holder.appendChild(col);
  });
}

function toggleDetails(id){
  const elx = $("#details-"+id);
  elx.hidden = !elx.hidden;
}

/* ---------------------- CART ---------------------- */

function addToCart(id){
  const item = GOODS.find(x=>x.id===id); if(!item) return;
  // 1 –ø–æ–∑–∏—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ id
  if (state.cart.some(x=>x.id===id)) { toast('–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ'); return; }
  state.cart.push({ id:item.id, name:item.name, price:priceFor(item) });
  updateCartUI();
  sendData({action:'cart_add', items:state.cart});
}
function removeFromCart(id){
  state.cart = state.cart.filter(x=>x.id!==id);
  updateCartUI();
  sendData({action:'cart_remove', items:state.cart});
}
function clearCart(){
  state.cart = [];
  updateCartUI();
  sendData({action:'cart_clear'});
}

function updateCartUI(){
  $("#u-name").textContent='@'+state.user.username;
  $("#u-cart").textContent=String(state.cart.length);
  const list = $("#cart-list");
  if (state.cart.length===0){ list.textContent='–ü—É—Å—Ç–æ'; }
  else{
    list.innerHTML = state.cart.map(i=>`
      <div class="cart-item">
        <div>${i.name}</div>
        <div class="row">
          <div class="muted nowrap">${fmtMoney(i.price)}</div>
          <button class="btn ghost" onclick="removeFromCart('${i.id}')">—É–±—Ä–∞—Ç—å</button>
        </div>
      </div>
    `).join('');
  }
  const total = state.cart.reduce((s,i)=>s+i.price,0);
  $("#cart-total").textContent = (state.currency==='EUR') ? '‚Ç¨'+total : (total*EUR_USDT).toFixed(2)+' USDT';
}

function updatePrices(){
  state.term = parseInt($("#term").value,10) || 1;
  state.currency = $("#currency").value;
  renderCatalog();
  // –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ –Ω–æ–≤–æ–º—É —Å—Ä–æ–∫—É
  state.cart = state.cart.map(c=>{
    const src = GOODS.find(g=>g.id===c.id);
    return { id:c.id, name:c.name, price: priceFor(src) };
  });
  updateCartUI();
}

/* ---------------------- CHECKOUT ---------------------- */

function openModal(id){ document.getElementById(id).showModal(); }
function closeModal(id){ document.getElementById(id).close(); }

function buildSummaryHTML(){
  const rows = state.cart.map(i=>`<div class="cart-item"><div>${i.name}</div><div class="muted">${fmtMoney(i.price)}</div></div>`).join('');
  const total = state.cart.reduce((s,i)=>s+i.price,0);
  const totalFmt = fmtMoney(total);
  return `
    <div class="muted">–°—Ä–æ–∫: ${state.term} –º–µ—Å ‚Ä¢ –í–∞–ª—é—Ç–∞: ${state.currency}</div>
    <div class="hr"></div>
    <div class="cart-items">${rows || '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'}</div>
    <div class="line"><div class="badge">–ò—Ç–æ–≥–æ</div><div class="price">${totalFmt}</div></div>
  `;
}
function openCheckout(){
  if (state.cart.length===0) { toast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
  $("#checkout-summary").innerHTML = buildSummaryHTML();
  openModal('checkoutModal');
}
window.openModal = openModal; // used in button
function choosePay(method){
  const totalEur = state.cart.reduce((s,i)=>s+i.price,0);
  if (method==='crypto'){
    $("#pay-amount").textContent = (state.currency==='EUR') ? (totalEur*EUR_USDT).toFixed(2)+' USDT' : (totalEur*EUR_USDT).toFixed(2)+' USDT';
    generateQR();
    closeModal('checkoutModal'); openModal('cryptoModal');
  }else{
    $("#bank-order-id").textContent = String(Date.now());
    $("#bank-amount").textContent = '‚Ç¨'+totalEur;
    closeModal('checkoutModal'); openModal('bankModal');
  }
}
function confirmPaid(method){
  // –≤ —Ä–µ–∞–ª–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±–µ–∫–µ–Ω–¥
  sendData({action:'paid', method, items:state.cart, term:state.term, currency:state.currency});
  // –ª–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –∑–∞–∫–∞–∑–∞
  state.orders.push({
    id: Date.now(),
    items: state.cart.map(c=>c.name).join(', '),
    term: state.term, method, total: state.cart.reduce((s,i)=>s+i.price,0),
    status: '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ'
  });
  clearCart();
  renderOrders();
  closeModal(method==='crypto' ? 'cryptoModal' : 'bankModal');
  toast('–ó–∞—è–≤–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ!');
}

/* ---------------------- QR (tiny) ---------------------- */
/* –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π QR-—Ä–µ–Ω–¥–µ—Ä –≤ Canvas (–Ω–µ –∫—Ä–∏–ø—Ç–æ—Å–∏–ª—å–Ω—ã–π, –¥–ª—è –∞–¥—Ä–µ—Å–∞ –æ–∫).
   –ê–ª–≥–æ—Ä–∏—Ç–º —É–ø—Ä–æ—â—ë–Ω: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É QRCode for JS (–º–∏–∫—Ä–æ-–≤–µ—Ä—Å–∏—è). */
(function(){
  // Tiny QR: https://github.com/davidshimjs/qrcodejs (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤—ã–∂–∏–º–∫–∞)
  function QR8bitByte(data){ this.mode=1; this.data=data; }
  QR8bitByte.prototype={getLength:function(){return this.data.length},write:function(buffer){for(var i=0;i<this.data.length;i++)buffer.put(this.data.charCodeAt(i),8)}};
  var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30]]};
  function QRPolynomial(num, shift){var offset=0;while(offset<num.length&&num[offset]==0)offset++;this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++)this.num[i]=num[i+offset]}
  QRPolynomial.prototype={getLength:function(){return this.num.length},get:function(i){return this.num[i]}};
  function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount}
  QRRSBlock.getRSBlocks=function(type){return [new QRRSBlock(26,19)]}; // —É–ø—Ä–æ—â–µ–Ω–∏–µ: –≤–µ—Ä—Å–∏—è 1-L
  var QRMath={glog:function(n){return n},gexp:function(n){return n}};
  function QRBitBuffer(){this.buffer=[],this.length=0}
  QRBitBuffer.prototype={get:function(i){return ((this.buffer[Math.floor(i/8)]>>> (7 - i%8))&1)==1},put:function(num,length){for(var i=0;i<length;i++)this.putBit(((num>>> (length-i-1))&1)==1)},putBit:function(bit){if(this.length==this.buffer.length*8)this.buffer.push(0);if(bit)this.buffer[this.buffer.length-1]|=(128>>> (this.length%8));this.length++}};
  function QRCodeModel(){this.typeNumber=1;this.modules=null;this.moduleCount=0;this.dataList=[]}
  QRCodeModel.prototype={addData:function(data){this.dataList.push(new QR8bitByte(data))},make:function(){this.moduleCount=21;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++)this.modules[row][col]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.mapData(this.createData())},
    setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;this.modules[row+r][col+c]=(r>=0&&r<=6&&(c==0||c==6))||(c>=0&&c<=6&&(r==0||r==6))||(r>=2&&r<=4&&c>=2&&c<=4)} } },
    mapData:function(data){var inc=-1,row=this.moduleCount-1,bitIndex=0,byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;for(;;){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=((data[byteIndex]>>> (7-bitIndex))&1)==1}this.modules[row][col-c]=dark;if(++bitIndex==8){bitIndex=0;++byteIndex}}}row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break}}}},
    createData:function(){var buffer=new QRBitBuffer();for(var i=0;i<this.dataList.length;i++){var data=this.dataList[i];buffer.put(4,4);buffer.put(data.getLength(),8);data.write(buffer)}buffer.put(0,4);var totalDataCount=19;var bytes=new Array(totalDataCount);for(i=0;i<totalDataCount;i++)bytes[i]=0;for(i=0;i<buffer.length;i++)bytes[Math.floor(i/8)]|=((buffer.get(i)?1:0)<< (7 - i%8));return bytes}
  };
  window.QRCanvas = function(cnv, text, scale=8){
    const q = new QRCodeModel(); q.addData(text); q.make();
    const n=q.moduleCount, ctx=cnv.getContext('2d'); const size=n*scale; cnv.width=size; cnv.height=size; ctx.fillStyle='#fff'; ctx.fillRect(0,0,size,size); ctx.fillStyle='#000';
    for(let r=0;r<n;r++) for(let c=0;c<n;c++) if(q.modules[r][c]) ctx.fillRect(c*scale,r*scale,scale,scale);
  }
})();

function generateQR(){
  const addr = $("#pay-address").textContent.trim();
  QRCanvas($("#qr"), addr, 6);
}
function copyText(id){
  const el = $("#"+id);
  const txt = el.textContent;
  navigator.clipboard?.writeText(txt); toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
}

/* ---------------------- ORDERS ---------------------- */
function renderOrders(){
  const holder = $("#orders");
  if (state.orders.length===0){ holder.textContent='–ù–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ (–¥–µ–º–æ).'; return; }
  holder.innerHTML = state.orders.map(o=>`
    <div class="card" style="margin-bottom:10px">
      <div class="row" style="justify-content:space-between"><b>–ó–∞–∫–∞–∑ #${o.id}</b><span class="badge">${o.status}</span></div>
      <div class="muted">–ü–æ–∑–∏—Ü–∏–∏: ${o.items}</div>
      <div class="line"><div>–°—Ä–æ–∫: ${o.term} –º–µ—Å</div><div class="price">${fmtMoney(o.total)}</div></div>
    </div>
  `).join('');
}

/* ---------------------- DISCLAIMER ---------------------- */
function acceptDisclaimer(){
  localStorage.setItem('cryptoatm_disclaimer','ok');
  closeModal('disclaimerModal');
}
function declineDisclaimer(){
  // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp (–µ—Å–ª–∏ –∏–∑ TG), –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—Å—Ç
  if (tg && tg.close) tg.close();
  else toast('–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç: –¥–∏—Å–∫–ª–µ–π–º–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è—Ç');
}

/* ---------------------- NAV ---------------------- */
document.querySelectorAll('.tab').forEach(b=>{
  b.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    const t = b.dataset.tab;
    document.querySelectorAll('section[id^="tab-"]').forEach(s=>s.hidden = s.id!=='tab-'+t);
    if (t==='orders') renderOrders();
  });
});

/* ---------------------- BOOT ---------------------- */
(function boot(){
  $("#u-name").textContent='@'+state.user.username;
  if (localStorage.getItem('cryptoatm_disclaimer')!=='ok') openModal('disclaimerModal');
  renderCatalog(); updateCartUI();
})();

/* –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è onClick (–≤ —Ä–∞–∑–º–µ—Ç–∫–µ) */
window.addToCart = addToCart;
window.removeFromCart = removeFromCart;
window.clearCart = clearCart;
window.updatePrices = updatePrices;
window.openCheckout = openCheckout;
window.choosePay = choosePay;
window.confirmPaid = confirmPaid;
window.copyText = copyText;
window.toggleDetails = toggleDetails;
window.openModal = openModal;
window.closeModal = closeModal;
window.acceptDisclaimer = acceptDisclaimer;
window.declineDisclaimer = declineDisclaimer;
</script>
</body>
</html>
