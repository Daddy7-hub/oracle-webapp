<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>CryptoATM.tech ‚Äî Mini App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0b0d12; --panel:#111522; --card:#151a2a; --muted:#9aa3b2; --txt:#e8edf4;
    --brand:#7c4dff; --acc:#00e5ff; --green:#27e1a7; --danger:#ff6a88; --gold:#ffd76a;
    --r-lg:14px; --r-xl:18px; --b1:1px solid rgba(255,255,255,.08);
    --glow:0 0 0 1px rgba(124,77,255,.25), 0 10px 24px rgba(124,77,255,.18), 0 6px 16px rgba(0,229,255,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:radial-gradient(1200px 700px at 80% -10%, rgba(124,77,255,.15), transparent 60%),
             radial-gradient(900px 600px at -10% 20%, rgba(0,229,255,.12), transparent 60%), var(--bg);
    color:var(--txt);font:14px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  }
  .wrap{max-width:1000px;margin:0 auto;padding:16px 14px 28px}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:rgba(255,255,255,.03);border:var(--b1);border-radius:var(--r-xl);backdrop-filter:blur(6px)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 210deg,var(--brand),var(--acc),var(--green),var(--brand))}
  .brand h1{margin:0;font-size:18px}
  .brand p{margin:0;color:var(--muted);font-size:12px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;gap:6px;align-items:center;background:rgba(255,255,255,.05);border:var(--b1);border-radius:999px;padding:6px 10px}
  .pill{padding:6px 10px;background:rgba(124,77,255,.18);border:1px solid rgba(124,77,255,.38);border-radius:999px;font-weight:700;color:#d9ccff}

  .tabs{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0 16px}
  .tab{border:var(--b1);border-radius:12px;background:#141927;color:var(--txt);padding:8px 12px;font-weight:700;cursor:pointer;user-select:none}
  .tab.active{background:linear-gradient(135deg,rgba(124,77,255,.2),rgba(0,229,255,.15));box-shadow:var(--glow)}

  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}
  @media(max-width:960px){.col-8,.col-6,.col-4{grid-column:span 12}}

  .card{background:var(--card);border:var(--b1);border-radius:var(--r-xl);padding:14px}
  .subtle{color:var(--muted)}
  .h{margin:0 0 8px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .price{font-weight:900}
  .tag{font-size:11px;opacity:.8;border:1px dashed rgba(255,255,255,.25);padding:2px 6px;border-radius:999px}

  .btn{appearance:none;border:0;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer;transition:transform .05s ease, box-shadow .2s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(135deg,var(--acc),var(--green));color:#0b0d12;box-shadow:var(--glow)}
  .btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,.35);color:var(--txt)}
  .btn.warn{background:linear-gradient(135deg,rgba(255,106,136,.9),#ff9bb1);color:#1a0f12}
  .btn.small{padding:7px 10px;border-radius:10px;font-weight:700}

  input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#121726;color:var(--txt)}
  .line{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed rgba(255,255,255,.1);padding-top:10px;margin-top:10px}

  .note{background:rgba(255,106,136,.12);border:1px solid rgba(255,106,136,.35);border-radius:12px;padding:10px;color:#ffdbe4}
  .ok{background:rgba(39,225,167,.12);border:1px solid rgba(39,225,167,.35);border-radius:12px;padding:10px;color:#d9ffef}

  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .kpi .box{background:rgba(255,255,255,.03);border:var(--b1);border-radius:14px;padding:10px;text-align:center}
  .kpi b{font-size:18px}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>CryptoATM.tech</h1>
        <p>–ü–æ–¥–ø–∏—Å–∫–∏ ‚Ä¢ ATM-–º–æ–Ω–µ—Ç—ã ‚Ä¢ –†–µ—Ñ–µ—Ä–∞–ª—ã ‚Ä¢ –ó–∞–¥–∞–Ω–∏—è</p>
      </div>
    </div>
    <div class="chips">
      <div class="chip">üë§ <b id="u-name">@guest</b></div>
      <div class="chip">ATM: <b id="u-atm">0</b></div>
      <div class="chip">üß∫ <b id="u-cart">0</b></div>
    </div>
  </header>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="tabs" id="tabs">
    <button class="tab active" data-tab="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="tab" data-tab="wallet">üí∞ –ö–æ—à–µ–ª—ë–∫</button>
    <button class="tab" data-tab="tasks">üß© –ó–∞–¥–∞–Ω–∏—è</button>
    <button class="tab" data-tab="ref">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="tab" data-tab="raffle">üèÜ –†–æ–∑—ã–≥—Ä—ã—à</button>
    <button class="tab" data-tab="faq">‚ùì FAQ</button>
  </nav>

  <!-- SHOP -->
  <section id="tab-shop" class="grid">
    <div class="col-12 card">
      <div class="row" style="justify-content:space-between">
        <div>
          <h3 class="h">–¢–∞—Ä–∏—Ñ—ã</h3>
          <p class="subtle">–î–æ–±–∞–≤—å—Ç–µ –æ–¥–Ω–æ–≥–æ/–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç (—Ü–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∞–π—Ç—É).</p>
        </div>
        <div class="row">
          <span class="pill">‚Äì10% –∑–∞ 3 –º–µ—Å ‚Ä¢ ‚Äì20% –∑–∞ 6 –º–µ—Å</span>
        </div>
      </div>
    </div>

    <div id="tariffs" class="col-12 grid"></div>

    <div class="col-12 card">
      <h3 class="h">–ö–æ—Ä–∑–∏–Ω–∞</h3>
      <div id="cart-list" class="subtle">–ü—É—Å—Ç–æ</div>
      <div class="line">
        <div>
          –ò—Ç–æ–≥–æ: <span class="price">‚Ç¨<span id="cart-total">0</span></span>
          <span class="subtle">–∏–ª–∏</span>
          <span class="price"><span id="cart-total-atm">0</span> ATM</span>
        </div>
        <div class="row">
          <button class="btn ghost" data-action="cart.clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn primary" data-action="checkout.eur">–û–ø–ª–∞—Ç–∏—Ç—å ‚Ç¨</button>
          <button class="btn primary" data-action="checkout.atm">–û–ø–ª–∞—Ç–∏—Ç—å ATM</button>
        </div>
      </div>
      <div class="note" style="margin-top:10px">–û–ø–ª–∞—Ç–∞ ATM ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–ø—Ü–∏—è. –ú–æ–Ω–µ—Ç—ã —Ü–µ–Ω–Ω—ã –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ.</div>
    </div>
  </section>

  <!-- WALLET -->
  <section id="tab-wallet" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ö–æ—à–µ–ª—ë–∫ ATM</h3>
      <div class="kpi" style="margin:8px 0 12px">
        <div class="box">–ë–∞–ª–∞–Ω—Å<br><b id="atm-balance">0</b></div>
        <div class="box">–ö–ª–∏–∫–∏ —Å–µ–≥–æ–¥–Ω—è<br><b id="atm-tap-left">100</b></div>
        <div class="box">Daily –±–æ–Ω—É—Å<br><b id="atm-daily">–Ω–µ –ø–æ–ª—É—á–µ–Ω</b></div>
      </div>

      <div class="row">
        <button class="btn primary small" data-action="wallet.daily">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π +1</button>
        <button class="btn ghost small" data-action="wallet.tap">–ö–ª–∏–∫ +1 (–ª–∏–º–∏—Ç)</button>
      </div>

      <div class="line">
        <div class="row" style="flex:1">
          <input id="buy-usdt" type="number" value="50" min="5" step="1" placeholder="–°—É–º–º–∞ USDT">
          <select id="buy-chain">
            <option value="TRC20">TRC20</option>
            <option value="BEP20">BEP20</option>
            <option value="ERC20">ERC20</option>
          </select>
        </div>
        <div class="row">
          <button class="btn primary" data-action="wallet.buy">–ö—É–ø–∏—Ç—å ATM</button>
        </div>
      </div>

      <div class="ok" id="wallet-log" style="margin-top:10px">–õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</div>
    </div>
  </section>

  <!-- TASKS -->
  <section id="tab-tasks" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ó–∞–¥–∞–Ω–∏—è</h3>
      <p class="subtle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä—É—Ñ ‚Äî –º–æ–¥–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç, ATM –Ω–∞—á–∏—Å–ª—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
      <div id="tasks" class="grid"></div>
    </div>
  </section>

  <!-- REF -->
  <section id="tab-ref" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
      <div class="row" style="justify-content:space-between">
        <p class="subtle">–í–∞—à –∫–æ–¥: <b id="ref-my">REF0</b></p>
        <span class="tag">‚àí50% –¥—Ä—É–≥—É –∏ –∫–µ—à–±–µ–∫ –≤–∞–º (Premium/Enterprise)</span>
      </div>
      <div class="row">
        <input id="ref-code" placeholder="REF123456">
        <button class="btn primary" data-action="ref.bind">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button>
      </div>
      <div class="ok" style="margin-top:10px">–ó–∞ –æ–ø–ª–∞—Ç—É –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ ATM-–º–æ–Ω–µ—Ç—ã.</div>
    </div>
  </section>

  <!-- RAFFLE -->
  <section id="tab-raffle" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à</h3>
      <p class="subtle">–®–∞–Ω—Å ‚àù –≤–∞—à–µ–º—É –±–∞–ª–∞–Ω—Å—É ATM. –£—á–∞—Å—Ç–≤—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–≤—à–∏–µ —É—á–∞—Å—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.</p>
      <div class="row">
        <button class="btn primary" data-action="raffle.optin">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
      </div>
      <div class="ok" id="raffle-log" style="margin-top:10px">–°—Ç–∞—Ç—É—Å —É—á–∞—Å—Ç–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="tab-faq" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">FAQ</h3>
      <ul class="subtle" style="margin:8px 0 0 18px">
        <li>–ü–æ–¥–ø–∏—Å–∫–∏ –ø–æ–º–µ—Å—è—á–Ω–æ: One Bot, Standard, Premium, Enterprise.</li>
        <li>–û–ø–ª–∞—Ç–∞: ‚Ç¨ –∏–ª–∏ ATM-–º–æ–Ω–µ—Ç—ã (–ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ USDT TRC20/BEP20/ERC20).</li>
        <li>–†–µ—Ñ–µ—Ä–∞–ª—ã: –∫–æ–¥ REF&lt;–≤–∞—àID&gt;; –±–æ–Ω—É—Å—ã –∑–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö.</li>
        <li>–ó–∞–¥–∞–Ω–∏—è: –ø—Ä—É—Ñ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ATM.</li>
        <li>–†–æ–∑—ã–≥—Ä—ã—à: —Ä–∞–∑ –≤ –º–µ—Å—è—Ü; –≤–µ—Å —Ä–∞–≤–µ–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤—É ATM.</li>
      </ul>
    </div>
  </section>

</div>

<script>
  // ===== Telegram API
  const tg = window.Telegram?.WebApp;
  if (tg){ try { tg.expand(); tg.enableClosingConfirmation(); } catch(e){} }

  // ===== –ö–∞—Ç–∞–ª–æ–≥ (—Ü–µ–Ω—ã –∏–∑ —Å–∞–π—Ç–∞ CryptoATM.tech)
  const ITEMS = [
    // –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã (–µ—Å–ª–∏ —Ä–µ—à–∏—à—å –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø–æ—à—Ç—É—á–Ω–æ)
    {type:'bot', code:'CRYPTO_ATM_BOT', name:'Crypto ATM Bot', price_eur:71,  price_atm:2800, desc:'BTC-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —É—Ä–æ–≤–Ω–∏, SL/TP, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏'},
    {type:'bot', code:'ALERTS_BOT',     name:'Alerts Bot',     price_eur:71,  price_atm:2800, desc:'–ö–∏—Ç—ã, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, funding, OI'},
    {type:'bot', code:'NEWS_BOT',       name:'News Bot',       price_eur:71,  price_atm:2800, desc:'–ù–æ–≤–æ—Å—Ç–∏, –¥–∞–π–¥–∂–µ—Å—Ç—ã, —Ñ–∏–ª—å—Ç—Ä—ã'},
    // –ø–∞–∫–µ—Ç—ã
    {type:'pack',code:'STANDARD',   name:'Standard (3 –±–æ—Ç–∞)', price_eur:150, price_atm:6000,  desc:'3 –ª—é–±—ã—Ö –±–æ—Ç–∞ ‚Ä¢ —á–∞—Ç ‚Ä¢ —Ä–µ—Ñ. –±–∞–∑–æ–≤–∞—è'},
    {type:'pack',code:'PREMIUM',    name:'Premium (4 –±–æ—Ç–∞)',  price_eur:191, price_atm:7600,  desc:'4 –±–æ—Ç–∞ ‚Ä¢ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–µ—Ñ. ‚Ä¢ lounge'},
    {type:'pack',code:'ENTERPRISE', name:'Enterprise (–≤—Å–µ)',   price_eur:249, price_atm:9900,  desc:'–í—Å–µ –±–æ—Ç—ã ‚Ä¢ VIP –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ‚Ä¢ –±–æ–Ω—É—Å—ã'}
  ];

  const TASKS = [
    {id:1, title:'–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Instagram', reward:10, type:'link', hint:'–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å'},
    {id:2, title:'–†–µ–ø–æ—Å—Ç —Å—Ç–æ—Ä–∏—Å',         reward:15, type:'link', hint:'–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–∏—Å'},
    {id:3, title:'–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞',      reward:25, type:'text', hint:'@username –¥—Ä—É–≥–∞'}
  ];

  // ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî –æ—Ñ—Ñ–ª–∞–π–Ω –¥–µ–º–æ)
  const state = {
    user: {
      id: tg?.initDataUnsafe?.user?.id || 0,
      name: tg?.initDataUnsafe?.user?.username || 'guest'
    },
    atm: 0,
    cart: [],
    taps_left: 100,
    daily_claimed: false
  };

  // ===== helpers
  const $  = (s)=> document.querySelector(s);
  const $$ = (s)=> Array.from(document.querySelectorAll(s));
  function toast(t){ if(tg?.showPopup) tg.showPopup({title:'', message:String(t)}); else console.log('[toast]', t); }
  function sendData(obj){
    const payload = JSON.stringify(obj);
    if (tg?.sendData) { tg.sendData(payload); }
    else { console.log('[offline send]', payload); }
  }

  // ===== –¢–∞—Ä–∏—Ñ—ã
  function renderTariffs(){
    const holder = $('#tariffs'); holder.innerHTML = '';
    ITEMS.forEach(it=>{
      const el = document.createElement('div');
      el.className = 'col-4 card';
      el.innerHTML = `
        <h3 class="h">${it.name}</h3>
        <p class="subtle">${it.desc || ''}</p>
        <div class="row" style="margin:6px 0 8px">
          <span class="chip">‚Ç¨ <b>${it.price_eur}</b> / –º–µ—Å</span>
          <span class="chip"><b>${it.price_atm}</b> ATM</span>
          ${it.type==='pack' ? '<span class="tag">–ø–∞–∫–µ—Ç</span>' : '<span class="tag">–±–æ—Ç</span>'}
        </div>
        <div class="line">
          <span class="subtle">${it.type==='pack'?'–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä':'–æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç'}</span>
          <div class="row">
            <button class="btn ghost small" data-action="item.info" data-code="${it.code}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="btn primary small" data-action="cart.add" data-code="${it.code}">–í –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>`;
      holder.appendChild(el);
    });
  }

  function updateCartUI(){
    $('#u-cart').textContent = String(state.cart.length);
    const list = $('#cart-list');
    if (state.cart.length===0){ list.textContent='–ü—É—Å—Ç–æ'; }
    else {
      list.innerHTML = state.cart.map(x=>`
        <div class="line">
          <div>${x.name}</div>
          <div class="row">
            <span class="subtle">‚Ç¨${x.price_eur} / ${x.price_atm} ATM</span>
            <button class="btn ghost small" data-action="cart.remove" data-code="${x.code}">—É–±—Ä–∞—Ç—å</button>
          </div>
        </div>
      `).join('');
    }
    const totalE = state.cart.reduce((s,x)=>s+x.price_eur,0);
    const totalA = state.cart.reduce((s,x)=>s+x.price_atm,0);
    $('#cart-total').textContent = totalE;
    $('#cart-total-atm').textContent = totalA;
  }

  // ===== Wallet
  function updateATMUI(){
    $('#u-atm').textContent       = String(state.atm);
    $('#atm-balance').textContent = String(state.atm);
    $('#atm-tap-left').textContent= String(state.taps_left);
    $('#atm-daily').textContent   = state.daily_claimed ? '–ø–æ–ª—É—á–µ–Ω' : '–Ω–µ –ø–æ–ª—É—á–µ–Ω';
  }

  // ===== Tasks
  function renderTasks(){
    const holder = $('#tasks'); holder.innerHTML='';
    TASKS.forEach(t=>{
      const el = document.createElement('div');
      el.className='col-6 card';
      el.innerHTML = `
        <h3 class="h">#${t.id} ${t.title}</h3>
        <p class="subtle">–ù–∞–≥—Ä–∞–¥–∞: <b>+${t.reward} ATM</b></p>
        <input data-task-proof="${t.id}" placeholder="${t.hint}">
        <div class="line">
          <span class="subtle">–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</span>
          <button class="btn primary small" data-action="task.submit" data-id="${t.id}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>`;
      holder.appendChild(el);
    });
  }

  // ===== –ù–∞–≤–∏–≥–∞—Ü–∏—è
  $('#tabs').addEventListener('click', (e)=>{
    const btn = e.target.closest('.tab'); if(!btn) return;
    $$('.tab').forEach(x=>x.classList.remove('active')); btn.classList.add('active');
    const name = btn.dataset.tab;
    $$('section[id^="tab-"]').forEach(s=> s.hidden = (s.id !== 'tab-'+name) );
    if(name==='shop'){ renderTariffs(); updateCartUI(); }
    if(name==='wallet'){ updateATMUI(); }
    if(name==='tasks'){ renderTasks(); }
    if(name==='ref'){ $('#ref-my').textContent = 'REF'+(state.user.id||0); }
  });

  // ===== –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
  document.body.addEventListener('click', (e)=>{
    const a = e.target.closest('[data-action]'); if(!a) return;
    const act = a.dataset.action;

    // —Ç–æ–≤–∞—Ä—ã
    if(act==='item.info'){
      const code = a.dataset.code; const it = ITEMS.find(x=>x.code===code);
      if(!it) return;
      toast(`${it.name}\n\n${it.desc}\n\n–¶–µ–Ω–∞: ‚Ç¨${it.price_eur} / ${it.price_atm} ATM`);
      return;
    }
    if(act==='cart.add'){
      const code = a.dataset.code; const it = ITEMS.find(x=>x.code===code);
      if(!it) return;
      if (state.cart.some(x=>x.code===code)) { toast('–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ'); return; }
      state.cart.push({code:it.code, name:it.name, price_eur:it.price_eur, price_atm:it.price_atm});
      updateCartUI(); sendData({action:'cart_add', code});
      return;
    }
    if(act==='cart.remove'){
      const code = a.dataset.code;
      state.cart = state.cart.filter(x=>x.code!==code);
      updateCartUI(); sendData({action:'cart_remove', code});
      return;
    }
    if(act==='cart.clear'){ state.cart=[]; updateCartUI(); sendData({action:'cart_clear'}); return; }

    // –æ–ø–ª–∞—Ç–∞
    if(act==='checkout.eur'){
      if(state.cart.length===0) return toast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
      const items = state.cart.map(x=>x.code);
      sendData({action:'checkout', method:'eur', items});
      toast('–°—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É ‚Ç¨ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç');
      state.cart=[]; updateCartUI();
      return;
    }
    if(act==='checkout.atm'){
      if(state.cart.length===0) return toast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
      const totalA = state.cart.reduce((s,x)=>s+x.price_atm,0);
      if(tg){ sendData({action:'checkout', method:'atm', items: state.cart.map(x=>x.code)}); }
      else { // –æ—Ñ—Ñ–ª–∞–π–Ω –¥–µ–º–æ
        if(state.atm < totalA) { toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ATM (–¥–µ–º–æ)'); return; }
        state.atm -= totalA; updateATMUI(); toast('–û–ø–ª–∞—Ç–∞ ATM –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ (–¥–µ–º–æ)');
      }
      state.cart=[]; updateCartUI();
      return;
    }

    // –∫–æ—à–µ–ª—ë–∫
    if(act==='wallet.daily'){
      if(tg){ sendData({action:'daily_claim'}); }
      if(!state.daily_claimed){ state.daily_claimed = true; state.atm += 1; updateATMUI(); }
      else toast('–°–µ–≥–æ–¥–Ω—è —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ');
      return;
    }
    if(act==='wallet.tap'){
      if(tg){ sendData({action:'tap'}); }
      if(state.taps_left>0){ state.taps_left--; state.atm++; updateATMUI(); }
      else toast('–õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω');
      return;
    }
    if(act==='wallet.buy'){
      const usdt = parseInt($('#buy-usdt').value||'0',10), chain = $('#buy-chain').value;
      if(!usdt || usdt<5) return toast('–ú–∏–Ω–∏–º—É–º 5 USDT');
      sendData({action:'buy_atm', usdt, chain});
      $('#wallet-log').textContent = `–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É ${usdt} USDT (${chain}) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ñ–¥–∏—Ç–µ —Å—á—ë—Ç.`;
      return;
    }

    // –∑–∞–¥–∞–Ω–∏—è
    if(act==='task.submit'){
      const id = Number(a.dataset.id);
      const proof = (document.querySelector(`[data-task-proof="${id}"]`)?.value || '').trim();
      if(!proof) return toast('–î–æ–±–∞–≤—å—Ç–µ –ø—Ä—É—Ñ');
      sendData({action:'task_submit', task_id:id, proof});
      document.querySelector(`[data-task-proof="${id}"]`).value='';
      toast('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ.');
      return;
    }

    // —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞
    if(act==='ref.bind'){
      const code = ($('#ref-code').value||'').trim();
      if(!code) return toast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');
      sendData({action:'ref_bind', code});
      toast('–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ï—Å–ª–∏ –∫–æ–¥ –≤–∞–ª–∏–¥–µ–Ω, –±—É–¥–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—ë–Ω.');
      return;
    }

    // —Ä–æ–∑—ã–≥—Ä—ã—à
    if(act==='raffle.optin'){
      sendData({action:'raffle_optin'});
      $('#raffle-log').textContent='–í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ. –£–¥–∞—á–∏!';
      return;
    }
  });

  // ===== –°—Ç–∞—Ä—Ç
  (function boot(){
    $('#u-name').textContent = '@'+(state.user.name);
    $('#ref-my').textContent = 'REF'+(state.user.id||0);
    renderTariffs(); updateCartUI(); updateATMUI();
  })();
</script>
</body>
</html>
