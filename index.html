<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CryptoATM Mini App</title>

    <!-- React + ReactDOM (–ø—Ä–æ–¥–æ–≤—ã–µ UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel –¥–ª—è JSX –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–¥–µ–º–æ/—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body style="margin:0;background:#0a0b0e;color:#f1f5fb">
    <div id="root"></div>

    <script type="text/babel">
'use client';
const { useEffect } = React;

function CryptoATMMiniApp() {
  useEffect(() => {
    const tg = (window && window.Telegram && window.Telegram.WebApp) || null;
    try {
      tg && tg.expand && tg.expand();
      tg && tg.setHeaderColor && tg.setHeaderColor("#0a0b0e");
      tg && tg.setBackgroundColor && tg.setBackgroundColor("#0a0b0e");
    } catch (e) {}

    const ADMIN_IDS = [568646738];
    const START_BONUS_ATM = 250;
    const REF_BONUS_ATM = 200;

    const CATALOG = [
      { type: "bot", code: "CRYPTO_ATM", name: "Crypto ATM Bot", price: 71, desc: "BTC-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —É—Ä–æ–≤–Ω–∏, —Å–∏–≥–Ω–∞–ª—ã –µ–∂–µ–¥–Ω–µ–≤–Ω–æ." },
      { type: "bot", code: "ALERTS", name: "Alerts Bot", price: 39, desc: "–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã: –∫–∏—Ç—ã, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, funding, OI, –æ–±—ä—ë–º—ã, —É—Ä–æ–≤–Ω–∏." },
      { type: "bot", code: "NEWS", name: "News & Events Bot", price: 29, desc: "CoinMarketCal + RSS, –ø–µ—Ä–µ–≤–æ–¥, —Ñ–∏–ª—å—Ç—Ä—ã, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –¥–∞–π–¥–∂–µ—Å—Ç." },
      { type: "pack", code: "PREMIUM", name: "Premium (–≤—Å–µ 3 –±–æ—Ç–∞)", price: 99, desc: "–í—Å–µ –±–æ—Ç—ã —Å–æ —Å–∫–∏–¥–∫–æ–π." },
      { type: "pack", code: "ENTERPRISE", name: "Enterprise", price: 199, desc: "–í—Å–µ –±–æ—Ç—ã + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç + –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏." },
      { type: "service", code: "COPY", name: "–ö–æ–ø–∏—Ç—Ä–µ–π–¥–∏–Ω–≥", price: 50, desc: "‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–º, –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å." },
    ];
    const CATALOG_LONG = {
      CRYPTO_ATM: { bullets: ["BTC-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞: —É—Ä–æ–≤–Ω–∏, –∑–æ–Ω—ã —Å–ø—Ä–æ—Å–∞/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Å—Ü–µ–Ω–∞—Ä–∏–∏","–°–∏–≥–Ω–∞–ª—ã —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É –∞–ª–µ—Ä—Ç—É","–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ–±–∑–æ—Ä—ã + –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (OI, funding, –æ–±—ä–µ–º—ã)"] },
      ALERTS:     { bullets: ["–ö—Ä—É–ø–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –∫–∏—Ç–æ–≤ (—Å–ø–æ—Ç/—Ñ—å—é—á), –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏","Funding/OI, –≤—Å–ø–ª–µ—Å–∫–∏ –æ–±—ä–µ–º–∞, –ª–æ–∫–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏","–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è + –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞"] },
      NEWS:       { bullets: ["CoinMarketCal + RSS: —Ñ–∏–ª—å—Ç—Ä—ã, –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å","–¢–æ–ø-3 –∑–∞ –ø–µ—Ä–∏–æ–¥, –¥–∞–π–¥–∂–µ—Å—Ç, —Ç–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏","–≠–∫—Å–ø–æ—Ä—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —É–º–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞"] },
      PREMIUM:    { bullets: ["–í—Å–µ 3 –±–æ—Ç–∞ –ø–æ —Å–Ω–∏–∂–µ–Ω–Ω–æ–π —Ü–µ–Ω–µ","–û–¥–∏–Ω –ø–ª–∞—Ç–µ–∂ ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø"] },
      ENTERPRISE: { bullets: ["–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞","–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"] },
      COPY:       { bullets: ["‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏","–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç"] },
    };

    const PERIOD_DISCOUNT = { 1: 0, 3: 0.1, 6: 0.2 };

    const PAY_ADDR_ADMIN = {
      BEP20: "0x5af48f9d26edb82e7c30247e105fbf61d2dd1a5c",
      TRC20: "TYcRjK3fFvV2W1k2p7t1B5u8A9XyZqQrTs",
      ERC20: "0x1111222233334444555566667777888899990000",
    };
    const PAY_ADDR_COMPANY = {
      BEP20: "0x5af48f9d26edb82e7c30247e105fbf61d2dd1a5c",
      TRC20: "TYcRjK3fFvV2W1k2p7t1B5u8A9XyZqQrTs",
      ERC20: "0x1111222233334444555566667777888899990000",
    };

    const $  = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));

    const DBKEY = "CATM_DB_v3";
    const loadDB = () => {
      try {
        return JSON.parse(localStorage.getItem(DBKEY) || "null") || { users: {}, orders: [], tasks: [], disclaimerAccepted: {} };
      } catch { return { users: {}, orders: [], tasks: [], disclaimerAccepted: {} }; }
    };
    const db = loadDB();
    const saveDB = () => localStorage.setItem(DBKEY, JSON.stringify(db));

    const rawUser = tg && tg.initDataUnsafe && tg.initDataUnsafe.user;
    const CURRENT_USER = rawUser
      ? { id: rawUser.id, username: rawUser.username || "user", name: (rawUser.first_name || "") + (rawUser.last_name ? " " + rawUser.last_name : "") }
      : { id: 0, username: "guest", name: "Guest" };

    if (!db.users[CURRENT_USER.id]) {
      db.users[CURRENT_USER.id] = {
        id: CURRENT_USER.id, username: CURRENT_USER.username, created_at: new Date().toISOString(),
        atm: START_BONUS_ATM, ref_code: "REF" + (CURRENT_USER.id || Math.floor(Math.random() * 1e6)),
        referred_by: null, orders: [], referrals: [], tasks: [], start_bonus_given: true,
      };
      saveDB();
    }
    const user = () => db.users[CURRENT_USER.id];

    const tabAdminBtn = $("#tab-admin-btn");
    if (tabAdminBtn) tabAdminBtn.hidden = !ADMIN_IDS.includes(CURRENT_USER.id);

    const state = {
      period: 1, atmDiscount: 0, cart: [],
      pay: { chain: "BEP20", dest: "admin", addr: PAY_ADDR_ADMIN.BEP20, amount: 0, memo: "" },
    };
    const setHash = (tab) => (location.hash = "#/" + tab);
    const currentTab = () => location.hash.replace("#/", "") || "shop";
    const applyBottomOffset = () => {
      const bar = $("#bottom-bar");
      if (!bar) return;
      document.documentElement.style.setProperty("--bottom-h", Math.ceil(bar.getBoundingClientRect().height) + "px");
    };

    const renderHeader = () => {
      const chipName = $("#chip-name");
      const chipAtm = $("#chip-atm");
      const chipOrders = $("#chip-orders");
      const refCode = $("#ref-code");
      if (chipName) chipName.textContent = "@" + (CURRENT_USER.username || "guest");
      if (chipAtm)  chipAtm.textContent  = String(user().atm);
      if (chipOrders) chipOrders.textContent = String(user().orders.length);
      if (refCode)  refCode.value = user().ref_code;
    };

    const priceFor = (item, months) => {
      const disc = PERIOD_DISCOUNT[months] || 0;
      const perMonth = Math.round(item.price * (1 - disc));
      return perMonth * months;
    };

    const updateCartUI = () => {
      const eur = state.cart.reduce((s, x) => s + x.amount, 0);
      const atmMax = Math.floor(eur * 0.25) * 100;
      const wantATM = Math.min(state.atmDiscount || 0, atmMax, user().atm);
      const eurMinus = Math.floor(wantATM / 100);
      const finalEur = Math.max(0, eur - eurMinus);
      const cartCount = $("#cart-count");
      const cartTotalEur = $("#cart-total-eur");
      const cartTotalAtm = $("#cart-total-atm");
      const cartTotalFinal = $("#cart-total-final");
      if (cartCount) cartCount.textContent = String(state.cart.length);
      if (cartTotalEur) cartTotalEur.textContent = "‚Ç¨" + eur;
      if (cartTotalAtm) cartTotalAtm.textContent = wantATM + " ATM";
      if (cartTotalFinal) cartTotalFinal.textContent = "‚Ç¨" + finalEur;
      renderHeader();
      applyBottomOffset();
    };

    const renderCatalog = () => {
      const grid = $("#catalog");
      if (!grid) return;
      grid.innerHTML = "";
      const periodEl = document.getElementById("period");
      const atmEl = document.getElementById("atm-discount");
      const months = (state.period = parseInt((periodEl && periodEl.value) || "1", 10));
      state.atmDiscount = Math.max(0, parseInt((atmEl && atmEl.value) || "0", 10));
      const eur = state.cart.reduce((s, x) => s + x.amount, 0);
      const atmMax = Math.floor(eur * 0.25) * 100;
      if (state.atmDiscount > atmMax) {
        state.atmDiscount = atmMax;
        if (atmEl) atmEl.value = String(atmMax);
      }
      CATALOG.forEach((it) => {
        const total = priceFor(it, months);
        const inCart = state.cart.find((x) => x.code === it.code && x.months === months);
        const card = document.createElement("div");
        card.className = "col-4 card";
        card.innerHTML = `
          <div class="row" style="justify-content:space-between;align-items:start">
            <span class="badge">${it.type.toUpperCase()}</span>
            <span class="price" style="color:var(--gold)">‚Ç¨${total} / ${months}–º</span>
          </div>
          <h3 style="margin-top:6px">${it.name}</h3>
          <p class="muted">${it.desc}</p>
          <div class="line">
            <button class="btn" data-act="details" data-code="${it.code}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            ${inCart ? `<button class="btn" data-act="remove" data-code="${it.code}">–£–±—Ä–∞—Ç—å</button>` : `<button class="btn primary" data-act="add" data-code="${it.code}">–í –∫–æ—Ä–∑–∏–Ω—É</button>`}
          </div>`;
        grid.appendChild(card);
      });
      updateCartUI();
    };

    const addToCart = (code) => {
      const months = state.period;
      const it = CATALOG.find((x) => x.code === code);
      if (!it) return;
      if (state.cart.find((x) => x.code === code && x.months === months)) return;
      state.cart.push({ code: it.code, name: it.name, months, amount: priceFor(it, months) });
      updateCartUI();
      renderCatalog();
    };

    const removeFromCart = (code) => {
      const months = state.period;
      state.cart = state.cart.filter((x) => !(x.code === code && x.months === months));
      updateCartUI();
      renderCatalog();
    };

    const clearCart = () => {
      state.cart = [];
      updateCartUI();
      renderCatalog();
    };

    const renderOrders = () => {
      const tb = document.querySelector("#orders-table tbody");
      if (!tb) return;
      tb.innerHTML = "";
      const rows = db.orders.filter((o) => o.user === CURRENT_USER.id).slice().reverse();
      for (const o of rows) {
        const tr = document.createElement("tr");
        const names = o.items.map((i) => i.name + " √ó" + i.months + "–º").join(", ");
        tr.innerHTML = `<td>${o.id}</td><td>${names}</td><td>${o.items.reduce((s, i) => s + i.months, 0)} –º–µ—Å</td><td>${o.method}</td><td>‚Ç¨${o.eur_final} ${o.atm_used ? `(+${o.atm_used} ATM)` : ""}</td><td>${o.status}</td><td>${new Date(o.created_at).toLocaleString()}</td><td>${o.intent_id || "‚Äî"}</td>`;
        tb.appendChild(tr);
      }
      renderHeader();
    };

    const toast = (t) => {
      if (tg && tg.showPopup) tg.showPopup({ title: "", message: String(t), buttons: [{ type: "close" }] });
      else console.log("[toast]", t);
    };

    const openItemModal = (code) => {
      const it = CATALOG.find((x) => x.code === code);
      if (!it) return;
      const long = (CATALOG_LONG[code] && CATALOG_LONG[code].bullets) || [];
      const title = document.querySelector("#item-title");
      const desc = document.querySelector("#item-desc");
      const modal = document.querySelector("#modal-item");
      if (title) title.textContent = it.name;
      if (desc)  desc.innerHTML = `
        <div class="muted" style="margin-bottom:8px">${it.desc}</div>
        ${long.length ? `<ul class="muted">${long.map((b)=>`<li>${b}</li>`).join("")}</ul>` : ""}
      `;
      if (modal) modal.style.display = "flex";
    };
    const closeItem = () => { const m = document.querySelector("#modal-item"); if (m) m.style.display = "none"; };

    const getActiveAddr = () => {
      const book = state.pay.dest === "company" ? PAY_ADDR_COMPANY : PAY_ADDR_ADMIN;
      return book[state.pay.chain];
    };

    const drawQR = (text) => {
      const c = document.getElementById("qr");
      if (!c) return;
      const ctx = c.getContext && c.getContext("2d");
      if (!ctx) return;
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, c.width, c.height);
      ctx.fillStyle = "#000";
      let seed = 0;
      for (let i = 0; i < text.length; i++) seed = ((seed * 33 + text.charCodeAt(i)) >>> 0);
      const n = 21, s = Math.floor((c.width - 20) / n), off = 10;
      for (let y = 0; y < n; y++) for (let x = 0; x < n; x++) {
        seed = (seed * 1103515245 + 12345) >>> 0; const v = seed & 1;
        if (v) ctx.fillRect(off + x * s, off + y * s, s - 1, s - 1);
      }
    };

    const openCryptoModal = (eur, chain = "BEP20", memo = "") => {
      state.pay.chain = chain;
      state.pay.addr = getActiveAddr();
      const chainSel = document.getElementById("pay-chain-select");
      const destSel = document.getElementById("pay-dest-select");
      const addrEl = document.querySelector("#pay-addr");
      const amountEl = document.querySelector("#pay-amount");
      const memoEl = document.querySelector("#pay-memo");
      const modal = document.querySelector("#modal-crypto");
      if (chainSel) chainSel.value = chain;
      if (destSel)  destSel.value  = state.pay.dest;
      if (addrEl)   addrEl.textContent = state.pay.addr;
      if (amountEl) amountEl.textContent = `‚Ç¨${eur}`;
      if (memoEl)   memoEl.textContent   = memo || "CRYPTOATM";
      if (modal) modal.style.display = "flex";
      drawQR(state.pay.addr);
      applyBottomOffset();
    };
    const closeCrypto = () => { const m = document.getElementById("modal-crypto"); if (m) m.style.display = "none"; };

    const createPaymentIntent = async (order) => {
      const payload = {
        user_id: CURRENT_USER.id, username: CURRENT_USER.username,
        items: order.items, eur: order.eur_final, atm_used: order.atm_used,
        network: state.pay.chain, address: state.pay.addr, dest: state.pay.dest,
        memo: order.memo, initData: (tg && (tg.initData || tg.initDataUnsafe)) || null,
      };
      try {
        // const res = await fetch('https://YOUR_API/payment-intent', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        // const data = await res.json();
        // return data.intent_id || null;
        await new Promise((r) => setTimeout(r, 400));
        return "intent_" + Math.random().toString(36).slice(2, 9);
      } catch (e) { console.error(e); return null; }
    };

    const createOrder = () => {
      if (state.cart.length === 0) return toast("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
      const eur = state.cart.reduce((s, x) => s + x.amount, 0);
      const atmMax = Math.floor(eur * 0.25) * 100;
      const wantATM = Math.min(state.atmDiscount || 0, atmMax, user().atm);
      const eurMinus = Math.floor(wantATM / 100);
      const finalEur = Math.max(0, eur - eurMinus);
      if (wantATM > 0) user().atm = Math.max(0, user().atm - wantATM);
      const memo = "ORDER-" + (db.orders.length + 1);
      const order = {
        id: db.orders.length + 1, user: CURRENT_USER.id,
        items: state.cart.map((x) => ({ code: x.code, name: x.name, months: x.months, amount: x.amount })),
        method: "crypto", dest: state.pay.dest, eur, atm_used: wantATM, eur_final: finalEur,
        status: "waiting", created_at: new Date().toISOString(), memo, intent_id: null,
      };
      db.orders.push(order);
      user().orders.push(order.id);
      saveDB();
      state.cart = [];
      state.atmDiscount = 0;
      const atmInput = document.getElementById("atm-discount");
      if (atmInput) atmInput.value = "0";
      updateCartUI();
      renderOrders();
      state.pay.amount = finalEur;
      state.pay.memo = memo;
      openCryptoModal(finalEur, state.pay.chain, memo);
      createPaymentIntent(order).then((id) => {
        order.intent_id = id;
        saveDB();
        renderOrders();
        const memoEl = document.querySelector("#pay-memo");
        if (id && memoEl) memoEl.textContent = id;
      });
    };

    const renderRefs = () => {
      const refCode = document.querySelector("#ref-code");
      if (refCode) refCode.value = user().ref_code;
      const tb = document.querySelector("#ref-table tbody");
      if (tb) {
        tb.innerHTML = "";
        for (const r of (user().referrals || []).slice().reverse()) {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>@${(db.users[r.uid] && db.users[r.uid].username) || r.uid}</td><td>${new Date(r.at).toLocaleDateString()}</td><td>${r.paid ? "–î–∞" : "‚Äî"}</td><td>${r.reward || 0} ATM</td>`;
          tb.appendChild(tr);
        }
      }
      const hasRef = !!user().referred_by;
      const bindInput = document.querySelector("#ref-bind-input");
      const bindBtn = document.querySelector("#ref-bind-btn");
      if (bindInput) bindInput.disabled = hasRef;
      if (bindBtn) bindBtn.disabled = hasRef;
    };

    const TASK_DEF = [
      { id: 1, title: "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ TikTok", reward: 100, type: "link", hint: "–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å/—Å–∫—Ä–∏–Ω" },
      { id: 2, title: "–†–µ–ø–æ—Å—Ç –≤ —Å—Ç–æ—Ä–∏—Å", reward: 120, type: "link", hint: "–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–∏—Å" },
      { id: 3, title: "–û—Ç–∑—ã–≤ –æ –ø—Ä–æ–µ–∫—Ç–µ", reward: 150, type: "text", hint: "–¢–µ–∫—Å—Ç/—Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–∑—ã–≤" },
      { id: 4, title: "–ù–∞–∫–ª–µ–π–∫–∞ –Ω–∞ –∞–≤—Ç–æ", reward: 500, type: "image", hint: "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ" },
    ];

    const renderTasks = () => {
      const holder = document.querySelector("#tasks");
      if (!holder) return;
      holder.innerHTML = "";
      TASK_DEF.forEach((t) => {
        const col = document.createElement("div");
        col.className = "col-6 card";
        col.innerHTML = `<h3>#${t.id} ${t.title}</h3><p class="muted">–ù–∞–≥—Ä–∞–¥–∞: <b>+${t.reward} ATM</b></p><input id="proof-${t.id}" placeholder="${t.hint}"><div class="line"><span class="muted">–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</span><button class="btn primary" data-act="submit-task" data-id="${t.id}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>`;
        holder.appendChild(col);
      });
    };

    const renderBalance = () => { const el = document.querySelector("#atm-balance"); if (el) el.textContent = String(user().atm); };

    const renderAdmin = () => {
      const users = Object.values(db.users);
      const o = db.orders;
      const totalEur = o.reduce((s, x) => s + x.eur_final, 0);
      const totalAtm = users.reduce((s, u) => s + u.atm, 0);
      const stats = document.querySelector("#admin-stats");
      if (stats) stats.innerHTML = `<div class="row"><div class="chip">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: <b>${users.length}</b></div><div class="chip">–ó–∞–∫–∞–∑—ã: <b>${o.length}</b></div><div class="chip">–í—ã—Ä—É—á–∫–∞: <b>‚Ç¨${totalEur}</b></div><div class="chip">ATM –Ω–∞ –±–∞–ª–∞–Ω—Å–∞—Ö: <b>${totalAtm}</b></div></div>`;
      const utb = document.querySelector("#admin-users tbody");
      if (utb) {
        utb.innerHTML = "";
        users.slice().sort((a, b) => b.id - a.id).forEach((u) => {
          const refFrom = u.referred_by ? "@" + ((db.users[u.referred_by] && db.users[u.referred_by].username) || u.referred_by) : "‚Äî";
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${u.id}</td><td>@${u.username}</td><td>${u.atm}</td><td>${u.orders.length}</td><td>${u.ref_code}</td><td>${refFrom}</td><td>${new Date(u.created_at).toLocaleDateString()}</td>`;
          utb.appendChild(tr);
        });
      }
      const otb = document.querySelector("#admin-orders tbody");
      if (otb) {
        otb.innerHTML = "";
        db.orders.slice().reverse().forEach((or) => {
          const userName = "@" + ((db.users[or.user] && db.users[or.user].username) || or.user);
          const items = or.items.map((i) => i.code + "√ó" + i.months).join(", ");
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${or.id}</td><td>${userName}</td><td>${items}</td><td>${or.items.reduce((s, i) => s + i.months, 0)} –º–µ—Å</td><td>${or.method} (${or.dest || '-'})</td><td>${or.eur_final}</td><td>${or.atm_used}</td><td>${or.status}</td><td>${new Date(or.created_at).toLocaleString()}</td><td><button class="btn" data-act="mark-paid" data-id="${or.id}">–û–ø–ª–∞—á–µ–Ω</button> <button class="btn ghost" data-act="mark-cancel" data-id="${or.id}">–û—Ç–º–µ–Ω–∞</button></td>`;
          otb.appendChild(tr);
        });
      }

      const ttb = document.querySelector("#admin-tasks tbody");
      if (ttb) {
        ttb.innerHTML = "";
        users.forEach((u) => {
          (u.tasks || []).forEach((t, idx) => {
            if (t.status === "pending") {
              const def = TASK_DEF.find((d) => d.id === t.id) || { reward: 0, title: "#" + t.id };
              const tr = document.createElement("tr");
              tr.innerHTML = `<td>${u.id}</td><td>@${u.username}</td><td>#${t.id} ${def.title || ''}</td><td>${t.proof || ''}</td><td>+${def.reward} ATM</td><td>${t.status}</td><td><button class="btn" data-act="task-approve" data-uid="${u.id}" data-idx="${idx}">–û–¥–æ–±—Ä–∏—Ç—å</button> <button class="btn ghost" data-act="task-reject" data-uid="${u.id}" data-idx="${idx}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button></td>`;
              ttb.appendChild(tr);
            }
          });
        });
      }
    };

    const switchTab = (name) => {
      $$(".tab").forEach((b) => b.classList.toggle("active", b.dataset.tab === name));
      $$(".page").forEach((p) => p.classList.toggle("active", p.id === "page-" + name));
      if (name === "shop") renderCatalog();
      if (name === "orders") renderOrders();
      if (name === "ref") renderRefs();
      if (name === "tasks") renderTasks();
      if (name === "balance") renderBalance();
      if (name === "admin") renderAdmin();
      applyBottomOffset();
    };

    const onHashChange = () => switchTab(currentTab());
    window.addEventListener("hashchange", onHashChange);

    const clickHandler = (e) => {
      const target = e.target;
      const btn = target && target.closest && target.closest("button, .btn");
      if (!btn) return;
      if (btn.classList.contains("tab")) {
        const t = btn.dataset.tab;
        if (t) { setHash(t); switchTab(t); }
        return;
      }
      const act = btn.dataset.act;
      if (act === "add")      { addToCart(btn.dataset.code); return; }
      if (act === "remove")   { removeFromCart(btn.dataset.code); return; }
      if (act === "details")  { openItemModal(btn.dataset.code); return; }
      if (act === "submit-task") {
        const id = +btn.dataset.id;
        const proofEl = document.getElementById(`proof-${id}`);
        const proof = (proofEl && proofEl.value && proofEl.value.trim()) || "";
        if (!proof) return toast("–î–æ–±–∞–≤—å—Ç–µ –ø—Ä—É—Ñ");
        user().tasks = user().tasks || [];
        user().tasks.push({ id, proof, at: new Date().toISOString(), status: "pending" });
        saveDB();
        toast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É");
        if (proofEl) proofEl.value = "";
        return;
      }
      if (btn.id === "cart-clear")   { clearCart(); return; }
      if (btn.id === "checkout-btn") { createOrder(); return; }
      if (btn.id === "ref-copy")     { navigator.clipboard.writeText(user().ref_code).then(() => toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ")); return; }
      if (btn.id === "ref-bind-btn") {
        const inp = document.getElementById("ref-bind-input");
        const code = (inp && inp.value && inp.value.trim().toUpperCase()) || "";
        if (!code) return toast("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥");
        const owner = Object.values(db.users).find((u) => u.ref_code === code);
        if (!owner) return toast("–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω");
        if (owner.id === CURRENT_USER.id) return toast("–ù–µ–ª—å–∑—è –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å–≤–æ–π –∫–æ–¥");
        if (user().referred_by) return toast("–ö–æ–¥ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω");
        user().referred_by = owner.id;
        owner.referrals.push({ uid: CURRENT_USER.id, at: new Date().toISOString(), paid: false, reward: 0 });
        saveDB();
        renderRefs();
        toast("–ö–æ–¥ –ø—Ä–∏–≤—è–∑–∞–Ω");
        return;
      }
      if (btn.id === "admin-refresh") { renderAdmin(); return; }
      if (btn.id === "admin-export") {
        const blob = new Blob([JSON.stringify(db, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "cryptoatm_export.json"; a.click();
        URL.revokeObjectURL(url);
        return;
      }
      if (btn.id === "copy-addr")   { navigator.clipboard.writeText((document.getElementById("pay-addr")?.textContent || "")); toast("–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω"); return; }
      if (btn.id === "copy-amount") { navigator.clipboard.writeText(((document.getElementById("pay-amount")?.textContent) || "").replace("‚Ç¨", "")); toast("–°—É–º–º–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞"); return; }
      if (btn.id === "copy-memo")   { navigator.clipboard.writeText((document.getElementById("pay-memo")?.textContent || "")); toast("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"); return; }
      if (btn.id === "paid-btn")    { toast("–°–ø–∞—Å–∏–±–æ! –ú—ã –æ—Ç–º–µ—Ç–∏–º –∑–∞–∫–∞–∑ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏."); closeCrypto(); return; }
      if (btn.id === "close-crypto"){ closeCrypto(); return; }
      if (btn.id === "close-item")  { closeItem(); return; }
      if (btn.id === "auth-close")  { const m = document.getElementById("modal-auth"); if (m) m.style.display = "none"; return; }
      if (btn.id === "accept")      { db.disclaimerAccepted[CURRENT_USER.id] = true; saveDB(); const m = document.getElementById("modal-disclaimer"); if (m) m.style.display = "none"; return; }
      if (btn.id === "decline")     { if (tg && tg.close) tg.close(); else window.location.href = "about:blank"; return; }

      if (act === "mark-paid" && ADMIN_IDS.includes(CURRENT_USER.id)) {
        const id = +(btn.dataset.id || 0);
        const o = db.orders.find((x) => x.id === id);
        if (o) {
          o.status = "paid";
          const buyer = db.users[o.user];
          if (buyer && buyer.referred_by) {
            const refUser = db.users[buyer.referred_by];
            if (refUser) {
              const rec = (refUser.referrals || []).find((r) => r.uid === buyer.id);
              if (rec && !rec.paid) {
                rec.paid = true;
                if (!rec.reward || rec.reward === 0) {
                  rec.reward = REF_BONUS_ATM;
                  refUser.atm = (refUser.atm || 0) + REF_BONUS_ATM;
                }
              }
            }
          }
          saveDB(); renderOrders(); renderAdmin(); toast("–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω: paid");
        }
        return;
      }
      if (act === "mark-cancel" && ADMIN_IDS.includes(CURRENT_USER.id)) {
        const id = +(btn.dataset.id || 0);
        const o = db.orders.find((x) => x.id === id);
        if (o) { o.status = "canceled"; saveDB(); renderOrders(); renderAdmin(); toast("–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω: canceled"); }
        return;
      }
      if (act === "task-approve" && ADMIN_IDS.includes(CURRENT_USER.id)) {
        const uid = +(btn.dataset.uid || 0);
        const idx = +(btn.dataset.idx || -1);
        const u = db.users[uid];
        if (u && u.tasks && u.tasks[idx]) {
          const t = u.tasks[idx];
          const def = TASK_DEF.find((d) => d.id === t.id) || { reward: 0 };
          t.status = "approved";
          u.atm = (u.atm || 0) + (def.reward || 0);
          saveDB(); renderAdmin(); renderBalance(); toast(`–ó–∞–¥–∞–Ω–∏–µ #${t.id} –æ–¥–æ–±—Ä–µ–Ω–æ (+${def.reward} ATM)`);
        }
        return;
      }
      if (act === "task-reject" && ADMIN_IDS.includes(CURRENT_USER.id)) {
        const uid = +(btn.dataset.uid || 0);
        const idx = +(btn.dataset.idx || -1);
        const u = db.users[uid];
        if (u && u.tasks && u.tasks[idx]) {
          const t = u.tasks[idx];
          t.status = "rejected";
          saveDB(); renderAdmin(); toast(`–ó–∞–¥–∞–Ω–∏–µ #${t.id} –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ`);
        }
        return;
      }
    };

    const changeHandler = (e) => {
      const el = e.target;
      if (!el) return;
      if (el.id === "period" || el.id === "atm-discount") { renderCatalog(); }
      if (el.id === "pay-chain-select") {
        state.pay.chain = el.value;
        state.pay.addr = getActiveAddr();
        const addrEl = document.getElementById("pay-addr");
        if (addrEl) addrEl.textContent = state.pay.addr;
        drawQR(state.pay.addr);
      }
      if (el.id === "pay-dest-select") {
        state.pay.dest = el.value;
        state.pay.addr = getActiveAddr();
        const addrEl = document.getElementById("pay-addr");
        if (addrEl) addrEl.textContent = state.pay.addr;
        drawQR(state.pay.addr);
      }
    };

    const touchStart = (e) => { const b = e.target && e.target.closest && e.target.closest(".btn"); if (b) b.classList.add("touching"); };
    const touchEnd = () => $$(".btn.touching").forEach((b) => b.classList.remove("touching"));

    const ensureDisclaimer = () => {
      const ok = db.disclaimerAccepted[CURRENT_USER.id];
      const modal = document.getElementById("modal-disclaimer");
      if (!modal) return;
      modal.style.display = ok ? "none" : "flex";
    };

    const boot = () => {
      if (CURRENT_USER.id === 0) { const m = document.getElementById("modal-auth"); if (m) m.style.display = "flex"; }
      switchTab(currentTab());
      renderHeader();
      applyBottomOffset();
      ensureDisclaimer();
      setInterval(() => { const chip = document.getElementById("chip-atm"); if (chip) chip.textContent = String(user().atm); }, 1000);
    };

    document.addEventListener("click", clickHandler);
    document.addEventListener("change", changeHandler);
    document.addEventListener("touchstart", touchStart, { passive: true });
    document.addEventListener("touchend", touchEnd);

    console.assert(typeof priceFor === "function", "priceFor should be defined");
    console.assert(document.getElementById("catalog") !== null, "#catalog should exist");
    console.assert(document.getElementById("copy-amount") !== null, "#copy-amount button should exist");

    boot();

    return () => {
      document.removeEventListener("click", clickHandler);
      document.removeEventListener("change", changeHandler);
      document.removeEventListener("touchstart", touchStart);
      document.removeEventListener("touchend", touchEnd);
      window.removeEventListener("hashchange", onHashChange);
    };
  }, []);

  return (
    <>
      <style>{`
:root{--bg:#0a0b0e;--panel:#111319;--card:#141821;--muted:#a5adbb;--txt:#f1f5fb;--gold:#d4af37;--gold-2:#f5d77a;--gold-glow:rgba(212,175,55,.28);--accent:#00e5ff;--green:#22e39e;--danger:#ff6a88;--b1:1px solid rgba(255,255,255,.08);--r:14px;--r-xl:18px;--safe-top:env(safe-area-inset-top,0px);--safe-bot:env(safe-area-inset-bottom,0px);--bottom-h:96px;--shadow:0 6px 28px rgba(0,0,0,.35),0 0 0 1px rgba(255,255,255,.04) inset}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:radial-gradient(1200px 600px at 50% -200px, rgba(212,175,55,.08), transparent 60%), var(--bg);color:var(--txt);font:14px/1.45 system-ui,-apple-system,Inter,Segoe UI,Roboto,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}:focus-visible{outline:2px solid var(--accent); outline-offset:2px; border-radius:8px}.wrap{max-width:1160px;margin:0 auto;padding: calc(10px + var(--safe-top)) 14px calc(var(--bottom-h) + 14px)}
header{position:sticky; top:0; z-index:12; margin:0 -14px 14px; padding: calc(8px + var(--safe-top)) 14px 8px; background:linear-gradient(180deg, rgba(10,11,14,.95), rgba(10,11,14,.6)); backdrop-filter:saturate(120%) blur(6px); border-bottom: var(--b1)}.hbar{ display:flex; align-items:center; justify-content:space-between; gap:12px }.brand{ display:flex; align-items:center; gap:12px; min-width:0 }.logo{ width:44px; height:44px; border-radius:12px; background: radial-gradient(140% 140% at 30% 20%, var(--gold-2), var(--gold) 60%, #6e570f); box-shadow: inset 0 2px 10px rgba(255,255,255,.25), 0 4px 18px var(--gold-glow) }.brand h1{margin:0;font-size:18px;letter-spacing:.4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.brand small{display:block;color:var(--muted);margin-top:2px;font-size:12px}.userchips{display:flex;gap:8px;flex-wrap:wrap}.chip{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:var(--b1);border-radius:999px;padding:8px 12px;color:var(--txt)}
.tabs{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 0}.tab{appearance:none;border:var(--b1);background:var(--card);color:var(--txt);border-radius:12px;padding:8px 12px;font-weight:800;cursor:pointer}.tab.active{background:linear-gradient(135deg, rgba(245,215,122,.18), rgba(212,175,55,.14));box-shadow: 0 0 0 1px rgba(212,175,55,.5) inset}.page{display:none}.page.active{display:block}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}.col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}@media(max-width:1020px){.col-8,.col-6,.col-4{grid-column:span 12}}.card{background:var(--card);border:var(--b1);border-radius:var(--r-xl);padding:14px;box-shadow:var(--shadow)}.card h3{margin:0 0 8px}.muted{color:var(--muted)}.badge{display:inline-block;background:rgba(255,255,255,.06);border:var(--b1);border-radius:8px;padding:4px 8px;color:var(--muted);font-size:12px}
.btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:900;cursor:pointer;transition:transform .04s ease, box-shadow .2s ease;background:#1a2030;color:var(--txt);border:1px solid rgba(255,255,255,.1)}.btn.primary{background:linear-gradient(135deg, #715d1d, #f3d46b 40%, #c9a529);color:#0b0b0c;text-shadow:0 1px 0 rgba(255,255,255,.35);border:1px solid rgba(245,215,122,.65);box-shadow: 0 4px 18px rgba(212,175,55,.28), 0 1px 0 rgba(255,255,255,.25) inset}.btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,.3)}.btn:active{transform:translateY(1px)}.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}input,select,textarea{width:100%;padding:12px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#11161f;color:var(--txt);outline:none}select{padding-right:32px}.label{color:var(--muted);font-weight:700}.line{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed rgba(255,255,255,.1);padding-top:10px;margin-top:10px}.price{font-weight:900}.kv{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
.bottom-bar{position:fixed;left:0;right:0;bottom:0;z-index:20;pointer-events:none;background:linear-gradient(180deg, rgba(10,11,14,0), rgba(10,11,14,.96));padding:10px 10px calc(10px + var(--safe-bot))}.bb-inner{max-width:1160px;margin:0 –∞–≤—Ç–æ;display:flex;align-items:center;justify-content:space-between;gap:10px;background:#0e1117;border:var(--b1);border-radius:16px;padding:10px 12px;pointer-events:auto}
.modal-back{position:fixed;inset:0;z-index:30;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(3px);padding:20px 14px}.modal{max-width:680px;width:100%;background:#0e1117;border:var(--b1);border-radius:18px;box-shadow:var(--shadow);padding:16px}.modal h2{margin:0 0 10px}.modal .foot{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.table{width:100%;border-collapse:separate;border-spacing:0;border:var(--b1);border-radius:12px;overflow:hidden}.table th,.table td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08)}.table th{background:#101421;color:var(--muted);text-align:left}.table tr:last-child td{border-bottom:0}
.visually-hidden{position:absolute;left:-9999px}.btn.touching{filter:brightness(1.03)}
      `}</style>

      <div className="wrap">
        <header>
          <div className="hbar">
            <div className="brand">
              <div className="logo" aria-hidden="true" />
              <div>
                <h1 id="brand-title">CRYPTOATM.TECH</h1>
                <small>–ü–æ–¥–ø–∏—Å–∫–∏ ‚Ä¢ –ü–∞–∫–µ—Ç—ã ‚Ä¢ –ö–æ–ø–∏—Ç—Ä–µ–π–¥–∏–Ω–≥ ‚Ä¢ –†–µ—Ñ–µ—Ä–∞–ª—ã</small>
              </div>
            </div>
            <div className="userchips">
              <div className="chip">üë§ <b id="chip-name">@guest</b></div>
              <div className="chip">ATM: <b id="chip-atm">0</b></div>
              <div className="chip">–ó–∞–∫–∞–∑—ã: <b id="chip-orders">0</b></div>
            </div>
          </div>
          <nav className="tabs" id="tabs" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
            <button className="tab active" data-tab="shop" type="button">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
            <button className="tab" data-tab="orders" type="button">üìÑ –ó–∞–∫–∞–∑—ã</button>
            <button className="tab" data-tab="ref" type="button">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
            <button className="tab" data-tab="tasks" type="button">üß© –ó–∞–¥–∞–Ω–∏—è</button>
            <button className="tab" data-tab="balance" type="button">üí∞ –ë–∞–ª–∞–Ω—Å</button>
            <button className="tab" data-tab="admin" id="tab-admin-btn" type="button" hidden>üõ† –ê–¥–º–∏–Ω</button>
            <button className="tab" data-tab="faq" type="button">‚ùì FAQ</button>
          </nav>
        </header>

        <main id="pages">
          <section id="page-shop" className="page active">
            <div className="grid">
              <div className="col-12 card">
                <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏</h3>
                <p className="muted">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ 1/3/6 –º–µ—Å (—Å–∫–∏–¥–∫–∞ ~0/10/20%). ATM –º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å –¥–æ 25% (100 ATM = ‚Ç¨1).</p>
                <div className="row">
                  <div className="kv" style={{ minWidth: 240 }}>
                    <label className="label" htmlFor="period">–°—Ä–æ–∫</label>
                    <select id="period"><option value="1">1 –º–µ—Å—è—Ü</option><option value="3">3 –º–µ—Å—è—Ü–∞</option><option value="6">6 –º–µ—Å—è—Ü–µ–≤</option></select>
                  </div>
                  <div className="kv" style={{ minWidth: 260 }}>
                    <label className="label" htmlFor="atm-discount">–°–ø–∏—Å–∞—Ç—å ATM (–º–∞–∫—Å 25%)</label>
                    <input id="atm-discount" type="number" min={0} step={50} defaultValue={0} placeholder="0" inputMode="numeric" />
                  </div>
                </div>
              </div>
              <div id="catalog" className="col-12 grid"></div>
            </div>
          </section>

          <section id="page-orders" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
                <table className="table" id="orders-table"><thead><tr><th>‚Ññ</th><th>–¢–æ–≤–∞—Ä</th><th>–°—Ä–æ–∫</th><th>–ú–µ—Ç–æ–¥</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th><th>Intent</th></tr></thead><tbody></tbody></table>
              </div>
            </div>
          </section>

          <section id="page-ref" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                <p className="muted">–î–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º. –ó–∞ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥—Ä—É–∑–µ–π ‚Äî –±–æ–Ω—É—Å ATM. –í–∞—à –∫–æ–¥:</p>
                <div className="row"><input id="ref-code" readOnly /><button className="btn primary" id="ref-copy" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>
                <div className="line">
                  <div className="muted">–ü—Ä–∏–≤—è–∑–∞—Ç—å —á—É–∂–æ–π –∫–æ–¥</div>
                  <div className="row"><input id="ref-bind-input" placeholder="REF123456" /><button className="btn" id="ref-bind-btn" type="button">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button></div>
                </div>
                <div style={{ marginTop: 10 }}>
                  <table className="table" id="ref-table"><thead><tr><th>–ü–∞—Ä—Ç–Ω—ë—Ä</th><th>–î–∞—Ç–∞</th><th>–û–ø–ª–∞—Ç–∞</th><th>–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</th></tr></thead><tbody></tbody></table>
                </div>
              </div>
            </div>
          </section>

          <section id="page-tasks" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>–ó–∞–¥–∞–Ω–∏—è –∑–∞ ATM</h3>
                <div id="tasks" className="grid"></div>
              </div>
            </div>
          </section>

          <section id="page-balance" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>–ë–∞–ª–∞–Ω—Å ATM</h3>
                <p className="muted">–ö–æ–∏–Ω—ã –≤—ã–¥–∞—é—Ç—Å—è –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –∏ —á–µ—Ä–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã. –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.</p>
                <div className="row">
                  <div className="chip">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: <b id="atm-balance">0</b></div>
                </div>
              </div>
            </div>
          </section>

          <section id="page-admin" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
                <p className="muted">–°–≤–æ–¥–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∑–∞–∫–∞–∑–∞–º, —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º –∏ –∑–∞–¥–∞—á–∞–º.</p>
                <div className="row"><button className="btn" id="admin-refresh" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button><button className="btn ghost" id="admin-export" type="button">–≠–∫—Å–ø–æ—Ä—Ç JSON</button></div>
                <div className="grid" style={{ marginTop: 12 }}>
                  <div className="col-12 card" id="admin-stats"></div>
                  <div className="col-12 card"><h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3><table className="table" id="admin-users"><thead><tr><th>ID</th><th>Username</th><th>ATM</th><th>–ó–∞–∫–∞–∑—ã</th><th>–†–µ—Ñ-–∫–æ–¥</th><th>–û—Ç –∫–æ–≥–æ</th><th>–î–∞—Ç–∞</th></tr></thead><tbody></tbody></table></div>
                  <div className="col-12 card"><h3>–ó–∞–∫–∞–∑—ã</h3><table className="table" id="admin-orders"><thead><tr><th>#</th><th>User</th><th>–¢–æ–≤–∞—Ä</th><th>–°—Ä–æ–∫</th><th>–ú–µ—Ç–æ–¥</th><th>‚Ç¨</th><th>ATM</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody></tbody></table></div>
                  <div className="col-12 card"><h3>–ó–∞–¥–∞–Ω–∏—è (–æ–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)</h3><table className="table" id="admin-tasks"><thead><tr><th>UserID</th><th>Username</th><th>–ó–∞–¥–∞–Ω–∏–µ</th><th>–ü—Ä—É—Ñ</th><th>–ù–∞–≥—Ä–∞–¥–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody></tbody></table></div>
                </div>
              </div>
            </div>
          </section>

          <section id="page-faq" className="page">
            <div className="grid">
              <div className="col-12 card">
                <h3>FAQ</h3>
                <ul className="muted">
                  <li>–ü–æ–¥–ø–∏—Å–∫–∏: –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ –±–æ—Ç–∞–º –∏–ª–∏ –ø–∞–∫–µ—Ç—ã Premium/Enterprise; –∫–æ–ø–∏—Ç—Ä–µ–π–¥–∏–Ω–≥ ‚Äî ‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏.</li>
                  <li>–û–ø–ª–∞—Ç–∞: –∫—Ä–∏–ø—Ç–æ–π (QR/–∞–¥—Ä–µ—Å); —Å–∫–∏–¥–∫–∞ ATM –¥–æ 25% (100 ATM = ‚Ç¨1).</li>
                  <li>–†–µ—Ñ–µ—Ä–∞–ª—ã: –≤–∞—à –∫–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞ REF&lt;id&gt;. –ó–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö ‚Äî –±–æ–Ω—É—Å—ã.</li>
                  <li>–ó–∞–¥–∞–Ω–∏—è: –ø—Ä—É—Ñ—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π; –Ω–∞–≥—Ä–∞–¥–∞ –≤ ATM.</li>
                </ul>
              </div>
            </div>
          </section>
        </main>
      </div>

      <div className="bottom-bar" id="bottom-bar">
        <div className="bb-inner">
          <div className="row">
            <div className="chip">–ü–æ–∑–∏—Ü–∏–π: <b id="cart-count">0</b></div>
            <div className="chip">–ò—Ç–æ–≥–æ: <b id="cart-total-eur">‚Ç¨0</b> / <b id="cart-total-atm">0 ATM</b></div>
            <div className="chip">–° —É—á—ë—Ç–æ–º ATM: <b id="cart-total-final">‚Ç¨0</b></div>
          </div>
          <div className="row">
            <button className="btn" id="cart-clear" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button className="btn primary" id="checkout-btn" type="button">–û–ø–ª–∞—Ç–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <div className="modal-back" id="modal-auth" role="dialog" aria-modal="true" aria-labelledby="auth-title">
        <div className="modal">
          <h2 id="auth-title">–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
          <p className="muted">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Telegram, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å. –ï—Å–ª–∏ –≤—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ ‚Äî –≤–∫–ª—é—á–∏—Ç–µ Mini App –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ initData.</p>
          <div className="foot"><button className="btn" id="auth-close" type="button">–ó–∞–∫—Ä—ã—Ç—å</button></div>
        </div>
      </div>

      <div className="modal-back" id="modal-disclaimer" role="dialog" aria-modal="true" aria-labelledby="disc-title">
        <div className="modal">
          <h2 id="disc-title">–î–∏—Å–∫–ª–µ–π–º–µ—Ä</h2>
          <p className="muted">–≠—Ç–æ –Ω–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –†—ã–Ω–æ–∫ –≤–æ–ª–∞—Ç–∏–ª–µ–Ω; –ª—é–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã –º–æ–≥—É—Ç –æ—à–∏–±–∞—Ç—å—Å—è. –ü—Ä–æ–≤–æ–¥–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.</p>
          <div className="foot"><button className="btn" id="decline" type="button">–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω</button><button className="btn primary" id="accept" type="button">–Ø –ø–æ–Ω–∏–º–∞—é –∏ –Ω–µ—Å—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</button></div>
        </div>
      </div>

      <div className="modal-back" id="modal-crypto" role="dialog" aria-modal="true" aria-labelledby="pay-title">
        <div className="modal">
          <h2 id="pay-title">–û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π</h2>
          <p className="muted">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏ —Å–µ—Ç—å. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∞–¥—Ä–µ—Å. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)¬ª ‚Äî –∑–∞–∫–∞–∑ –ø–µ—Ä–µ–π–¥—ë—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É.</p>
          <div className="row">
            <canvas id="qr" width="180" height="180" style={{ background: "#fff", borderRadius: 8 }}></canvas>
            <div style={{ flex: 1 }}>
              <div className="kv"><span className="label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</span>
                <select id="pay-dest-select">
                  <option value="admin">–ë–∏—Ä–∂–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</option>
                  <option value="company">–°—á—ë—Ç –∫–æ–º–ø–∞–Ω–∏–∏</option>
                </select>
              </div>
              <div className="kv"><span className="label">–°–µ—Ç—å</span>
                <select id="pay-chain-select">
                  <option value="BEP20">BNB Smart Chain (USDC)</option>
                  <option value="TRC20">TRON TRC20 (USDT)</option>
                  <option value="ERC20" disabled>Ethereum ERC20 (—Å–∫–æ—Ä–æ)</option>
                </select>
              </div>
              <div className="kv"><span className="label">–ê–¥—Ä–µ—Å</span><code id="pay-addr" style={{ wordBreak: "break-all" }}></code></div>
              <div className="kv"><span className="label">–°—É–º–º–∞</span><b id="pay-amount">‚Äî</b> <button className="btn" id="copy-amount" type="button" style={{ marginLeft: 8 }}>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>
              <div className="kv"><span className="label">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</span><b id="pay-memo">‚Äî</b> <button className="btn" id="copy-memo" type="button" style={{ marginLeft: 8 }}>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>
              <div className="row" style={{ marginTop: 8 }}><button className="btn" id="copy-addr" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button><button className="btn primary" id="paid-btn" type="button">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button></div>
            </div>
          </div>
          <div className="foot"><button className="btn" id="close-crypto" type="button">–ó–∞–∫—Ä—ã—Ç—å</button></div>
        </div>
      </div>

      <div className="modal-back" id="modal-item" role="dialog" aria-modal="true" aria-labelledby="item-title">
        <div className="modal">
          <h2 id="item-title">–¢–æ–≤–∞—Ä</h2>
          <div id="item-desc" className="muted"></div>
          <div className="foot"><button className="btn" id="close-item" type="button">–ó–∞–∫—Ä—ã—Ç—å</button></div>
        </div>
      </div>
    </>
  );
}

// –ú–æ–Ω—Ç–∏—Ä—É–µ–º
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<CryptoATMMiniApp />);

// –ü–æ–∫–∞–∂–∏ –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ (–¥–ª—è –¥–µ–±–∞–≥–∞)
window.addEventListener('error', e => {
  console.error(e.error || e.message);
  const msg = (e.error && e.error.stack) || e.message;
  document.body.insertAdjacentHTML('afterbegin', `<pre style="position:fixed;z-index:9999;top:0;left:0;background:#000c;color:#fff;padding:8px;font:12px/1.3 monospace;max-width:100vw;white-space:pre-wrap">${msg}</pre>`);
});
    </script>
  </body>
</html>
