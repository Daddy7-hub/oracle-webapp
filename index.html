<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>CryptoATM.tech ‚Äî Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Telegram Mini Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0b0f17;
      --card: #0f1522;
      --card-2: #0e121b;
      --text: #f3f6ff;
      --muted: #a7b0c0;
      --brand: #6ee7b7;
      --brand-2: #22d3ee;
      --accent: #fde047;
      --danger: #fb7185;
      --ok: #34d399;
    }
    html, body { background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .glass { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.09); }
    .card { background: var(--card); border: 1px solid rgba(255,255,255,0.07); border-radius: 18px; }
    .chip { border: 1px solid rgba(255,255,255,.12); border-radius: 999px; padding: 4px 10px; }
    .btn { display: inline-flex; align-items: center; gap: .5rem; border-radius: 12px; padding: .7rem 1rem; font-weight: 600; }
    .btn-primary { background: linear-gradient(90deg, var(--brand), var(--brand-2)); color: #001015; }
    .btn-muted { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.1); }
    .btn-danger { background: rgba(251, 113, 133, .18); border: 1px solid rgba(251, 113, 133, .4); color: #fecdd3; }
    .btn-success { background: rgba(52, 211, 153, .18); border: 1px solid rgba(52, 211, 153, .4); color: #d1fae5; }
    .tab-active { background: rgba(255,255,255,.1); }
    .badge { font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12); color: var(--muted); }
    .grid-cards { display: grid; grid-template-columns: repeat(12, minmax(0,1fr)); gap: 14px; }
    .shadow-soft { box-shadow: 0 20px 80px rgba(0,0,0,.35); }
    .hidden-el { display: none; }
    .monos { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .divider { height: 1px; background: rgba(255,255,255,.08); margin: 10px 0; }
    .ring-focus:focus { outline: none; box-shadow: 0 0 0 3px rgba(34,211,238,.35); }
    .tag { font-size:12px; color: var(--muted); padding:2px 8px;border-radius:999px;border:1px dashed rgba(255,255,255,.18)}
    .blink { animation: blink 1.4s infinite }
    @keyframes blink { 50% { opacity: .4 } }
  </style>
</head>
<body>
  <div id="app" class="max-w-6xl mx-auto px-4 pb-28 pt-6">
    <!-- HEADER -->
    <header class="flex items-center justify-between gap-4 mb-6">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-300 to-cyan-300"></div>
        <div>
          <div class="text-xl font-extrabold tracking-tight">CryptoATM.tech</div>
          <div class="text-xs text-[var(--muted)]">–∫—Ä–∏–ø—Ç–æ-—Å–µ—Ä–≤–∏—Å –∏ –∫–æ–º—å—é–Ω–∏—Ç–∏</div>
        </div>
        <span id="demoBadge" class="badge ml-2 hidden-el">DEMO</span>
      </div>
      <div class="flex items-center gap-2">
        <span id="subStatusChip" class="chip">–ü–æ–¥–ø–∏—Å–∫–∞: ‚Äî</span>
        <button id="openPayTop" class="btn btn-primary">–û–ø–ª–∞—Ç–∏—Ç—å / –ü–æ–¥–ø–∏—Å–∫–∞</button>
      </div>
    </header>

    <!-- KPI STRIP -->
    <section class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
      <div class="card p-4">
        <div class="text-xs text-[var(--muted)]">–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç</div>
        <div class="text-2xl font-bold flex items-baseline gap-2"><span id="coins">0</span><span class="text-xs text-[var(--muted)]">CAT</span></div>
      </div>
      <div class="card p-4">
        <div class="text-xs text-[var(--muted)]">–ë–∏–ª–µ—Ç—ã –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ (–º–µ—Å.)</div>
        <div class="text-2xl font-bold" id="tickets">0</div>
      </div>
      <div class="card p-4">
        <div class="text-xs text-[var(--muted)]">–†–µ—Ñ–µ—Ä–∞–ª—ã</div>
        <div class="text-2xl font-bold" id="refs">0</div>
      </div>
      <div class="card p-4">
        <div class="text-xs text-[var(--muted)]">–®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞</div>
        <div class="text-2xl font-bold flex items-center gap-2"><span id="winChance">0.0%</span><span class="tag">–æ—Ü–µ–Ω–∫–∞</span></div>
      </div>
    </section>

    <!-- TABS -->
    <nav class="flex gap-2 mb-4 overflow-x-auto">
      <button class="chip tab-active" data-tab="home">–ì–ª–∞–≤–Ω–∞—è</button>
      <button class="chip" data-tab="pricing">–¢–∞—Ä–∏—Ñ—ã</button>
      <button class="chip" data-tab="clicker">–ö–ª–∏–∫–µ—Ä</button>
      <button class="chip" data-tab="tasks">–ó–∞–¥–∞–Ω–∏—è</button>
      <button class="chip" data-tab="raffle">–†–æ–∑—ã–≥—Ä—ã—à</button>
      <button class="chip" data-tab="ref">–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</button>
      <button class="chip" data-tab="help">–ü—Ä–æ—Ñ–∏–ª—å/Help</button>
    </nav>

    <!-- TABS CONTENT -->
    <main class="space-y-6">
      <!-- HOME -->
      <section id="tab-home" class="space-y-4">
        <div class="card p-5">
          <div class="flex flex-col md:flex-row md:items-center justify-between gap-3">
            <div>
              <div class="text-lg font-semibold">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</div>
              <p class="text-sm text-[var(--muted)]">–≠—Ç–æ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ CryptoATM.tech. –ó–¥–µ—Å—å –≤—ã –æ—Ñ–æ—Ä–º–ª—è–µ—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É, –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –∫–æ–ø–∏—Ç–µ –º–æ–Ω–µ—Ç—ã ü™ô CAT ‚Äî –æ–Ω–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —à–∞–Ω—Å—ã –≤—ã–∏–≥—Ä–∞—Ç—å –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –ø—Ä–∏–∑—ã.</p>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-success" id="btnStartTasks">–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è</button>
              <button class="btn btn-muted" id="btnOpenClicker">–ö–ª–∏–∫–µ—Ä</button>
            </div>
          </div>
        </div>

        <div class="grid-cards">
          <div class="col-span-12 md:col-span-7 card p-5 space-y-4">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold text-lg">–ù–æ–≤–æ—Å—Ç–∏ / –ê–Ω–æ–Ω—Å—ã</h3>
              <span class="badge">–µ–∂–µ–º–µ—Å—è—á–Ω–æ</span>
            </div>
            <ul id="newsList" class="space-y-3 text-sm">
              <li class="p-3 rounded-lg glass">üéÅ –í –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞ ‚Äî —Ä–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏–∑–æ–≤ —Å—Ä–µ–¥–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</li>
              <li class="p-3 rounded-lg glass">üì£ –ü–æ–¥–ø–∏—Å–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –±–∏–ª–µ—Ç–æ–≤.</li>
              <li class="p-3 rounded-lg glass">üõ† –°–∫–æ—Ä–æ: –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–æ–π.</li>
            </ul>
          </div>

          <div class="col-span-12 md:col-span-5 card p-5 space-y-3">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold text-lg">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <button class="btn btn-primary w-full" id="btnSubscribe">–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
              <button class="btn btn-muted w-full" id="btnPayCrypto">–û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
              <button class="btn btn-muted w-full" id="btnInvoice">–ò–Ω–≤–æ–π—Å –Ω–∞ —Ñ–∏—Ä–º—É</button>
              <button class="btn btn-muted w-full" id="btnSupport">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
            </div>
            <div class="divider"></div>
            <div class="text-xs text-[var(--muted)]">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ‚Äú–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)‚Äù ‚Äî –∑–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É.</div>
          </div>
        </div>
      </section>

      <!-- PRICING -->
      <section id="tab-pricing" class="hidden-el space-y-5">
        <div class="grid-cards">
          <!-- Cards will be injected -->
        </div>
        <div class="text-xs text-[var(--muted)]">*–û–ø–ª–∞—Ç–∞ –ø–æ–∫–∞ –≤—Ä—É—á–Ω—É—é: –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π (USDT/USDC) –∏–ª–∏ –∏–Ω–≤–æ–π—Å–æ–º –Ω–∞ —Ñ–∏—Ä–º—É. –î–æ–±–∞–≤–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∏–ª–ª–∏–Ω–≥ –ø–æ–∑–∂–µ.</div>
      </section>

      <!-- CLICKER -->
      <section id="tab-clicker" class="hidden-el space-y-4">
        <div class="card p-6 text-center space-y-4">
          <div class="text-sm text-[var(--muted)]">–ö–ª–∏–∫–∏ ‚Üí –º–æ–Ω–µ—Ç—ã CAT. –ï—Å—Ç—å –∫—É–ª–¥–∞—É–Ω –∏ –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç.</div>
          <div id="clickerCounter" class="text-5xl font-black tracking-tight">0</div>
          <button id="clickBtn" class="btn btn-primary text-xl px-6 py-4 mx-auto">–ö–õ–ò–ö ‚ö°Ô∏è</button>
          <div id="clickerHint" class="text-xs text-[var(--muted)]"></div>
        </div>
        <div class="card p-4">
          <div class="font-semibold mb-2">–ò—Å—Ç–æ—Ä–∏—è –∫–ª–∏–∫–æ–≤</div>
          <div id="clickHistory" class="text-xs text-[var(--muted)] space-y-1"></div>
        </div>
      </section>

      <!-- TASKS -->
      <section id="tab-tasks" class="hidden-el space-y-4">
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold text-lg">–ó–∞–¥–∞–Ω–∏—è</div>
              <div class="text-xs text-[var(--muted)]">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä—É—Ñ—ã ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ –º–æ–Ω–µ—Ç—ã –∏ —à–∞–Ω—Å –Ω–∞ –ø—Ä–∏–∑.</div>
            </div>
            <span class="badge">–º–æ–¥–µ—Ä–∞—Ü–∏—è</span>
          </div>
          <div id="tasksList" class="mt-4 space-y-3"></div>
        </div>
      </section>

      <!-- RAFFLE -->
      <section id="tab-raffle" class="hidden-el space-y-4">
        <div class="card p-5 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold text-lg">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à</div>
              <div class="text-xs text-[var(--muted)]">–ë–∏–ª–µ—Ç—ã = –º–æ–Ω–µ—Ç—ã √ó –º–Ω–æ–∂–∏—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∫–∏. –ß–µ–º –±–æ–ª—å—à–µ CAT, —Ç–µ–º –≤—ã—à–µ —à–∞–Ω—Å.</div>
            </div>
            <div class="tag" id="raffleMonth">–º–µ—Å—è—Ü ‚Äî ‚Ä¶</div>
          </div>
          <div class="grid md:grid-cols-3 gap-3">
            <div class="glass p-4 rounded-xl">
              <div class="text-xs text-[var(--muted)]">–ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥</div>
              <div id="prizePool" class="text-2xl font-bold">‚Äî</div>
            </div>
            <div class="glass p-4 rounded-xl">
              <div class="text-xs text-[var(--muted)]">–í–∞—à–∏ –±–∏–ª–µ—Ç—ã</div>
              <div id="yourTickets" class="text-2xl font-bold">0</div>
            </div>
            <div class="glass p-4 rounded-xl">
              <div class="text-xs text-[var(--muted)]">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–æ—Ü–µ–Ω–∫–∞)</div>
              <div id="yourChance" class="text-2xl font-bold">0%</div>
            </div>
          </div>
          <div class="divider"></div>
          <div class="text-sm text-[var(--muted)]">–ò—Ç–æ–≥–∏ ‚Äî –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞. –ú—ã —É–≤–µ–¥–æ–º–∏–º –≤ Telegram.</div>
        </div>
      </section>

      <!-- REFERRAL -->
      <section id="tab-ref" class="hidden-el space-y-4">
        <div class="card p-5 space-y-3">
          <div class="font-semibold text-lg">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</div>
          <div class="text-sm text-[var(--muted)]">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏ –±–∏–ª–µ—Ç—ã.</div>
          <div class="grid md:grid-cols-2 gap-3">
            <div class="glass p-4 rounded-xl">
              <div class="text-xs text-[var(--muted)] mb-1">–õ–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ (—á–∞—Ç)</div>
              <div class="flex items-center gap-2">
                <input id="refLink" class="w-full p-2 rounded-lg bg-transparent border border-white/10 monos ring-focus" readonly />
                <button id="copyRef" class="btn btn-muted">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
              <div class="text-xs text-[var(--muted)] mt-1">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —á–∞—Ç–µ: <span class="monos">t.me/<span id="botU1">BOT_USERNAME</span>?start=ref_<span id="refCode1">‚Äî</span></span></div>
            </div>
            <div class="glass p-4 rounded-xl">
              <div class="text-xs text-[var(--muted)] mb-1">–õ–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ (mini app)</div>
              <div class="flex items-center gap-2">
                <input id="refLinkApp" class="w-full p-2 rounded-lg bg-transparent border border-white/10 monos ring-focus" readonly />
                <button id="copyRefApp" class="btn btn-muted">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
              <div class="text-xs text-[var(--muted)] mt-1">–û—Ç–∫—Ä—ã—Ç–∏–µ –º–∏–Ω–∏-–∞–ø–ø–∞: <span class="monos">t.me/<span id="botU2">BOT_USERNAME</span>?startapp=ref_<span id="refCode2">‚Äî</span></span></div>
            </div>
          </div>
        </div>
      </section>

      <!-- HELP -->
      <section id="tab-help" class="hidden-el space-y-4">
        <div class="card p-5 space-y-2">
          <div class="font-semibold text-lg">–ü—Ä–æ—Ñ–∏–ª—å</div>
          <div class="text-sm text-[var(--muted)]">ID: <span id="uid">‚Äî</span></div>
          <div class="text-sm text-[var(--muted)]">Username: <span id="uname">‚Äî</span></div>
          <div class="text-sm text-[var(--muted)]">–ü–æ–¥–ø–∏—Å–∫–∞ –¥–æ: <span id="subUntil">‚Äî</span></div>
        </div>
        <div class="card p-5 space-y-2">
          <div class="font-semibold text-lg">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
          <div class="text-sm text-[var(--muted)]">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–∫–µ—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É.</div>
          <button id="openSupport" class="btn btn-muted">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
        </div>
      </section>
    </main>
  </div>

  <!-- MODALS -->
  <div id="modal" class="fixed inset-0 hidden-el items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative max-w-xl w-full card p-5 shadow-soft">
      <div id="modalContent"></div>
      <div class="mt-4 text-right">
        <button id="closeModal" class="btn btn-muted">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

<script>
/** =========================
 *  CONFIG (–ø–æ–¥ —Å–µ–±—è)
 *  ========================= */
const CONFIG = {
  botUsername: "BOT_USERNAME_HERE", // üëà –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –∏–º—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –±–µ–∑ @
  networks: [
    { key: "USDT-TRC20", title: "USDT (TRC-20)", address: "TRxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", note: "–£–∫–∞–∂–∏—Ç–µ memo: –≤–∞—à Telegram ID" },
    { key: "USDT-ERC20", title: "USDT (ERC-20)", address: "0xYourEthAddressHere", note: "–û–ø–ª–∞—Ç–∞ –≥–∞–∑–∞ –Ω–∞ –≤–∞—Å" },
    { key: "USDC-TRC20", title: "USDC (TRC-20)", address: "TRyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy", note: "" },
  ],
  tariffs: [
    { id: "basic", name: "Basic", price: 10, currency: "USDT", per: "–º–µ—Å", perks: ["–î–æ—Å—Ç—É–ø –≤ —Ö–∞–±", "–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à", "+0% –º–Ω–æ–∂–∏—Ç–µ–ª—å"], subMult: 1.0 },
    { id: "pro",   name: "Pro",   price: 25, currency: "USDT", per: "–º–µ—Å", perks: ["–í—Å–µ –∏–∑ Basic", "Pro-–∫–∞–Ω–∞–ª", "+50% –º–Ω–æ–∂–∏—Ç–µ–ª—å"], subMult: 1.5 },
    { id: "vip",   name: "VIP",   price: 60, currency: "USDT", per: "–º–µ—Å", perks: ["–í—Å–µ –∏–∑ Pro", "VIP-—á–∞—Ç", "+120% –º–Ω–æ–∂–∏—Ç–µ–ª—å"], subMult: 2.2 },
  ],
  clicker: { cooldownSec: 5, dailyLimit: 200, coinPerClick: 1 },
  tasks: [
    { id: "inst_follow", title: "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Instagram", reward: 50, type: "link", proofHint: "–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–∏–∫ @username –∏ —Å–∫—Ä–∏–Ω/—Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å.", link: "https://instagram.com/yourpage" },
    { id: "story_repost", title: "–†–µ–ø–æ—Å—Ç —Å—Ç–æ—Ä–∏—Å –æ –Ω–∞—Å", reward: 40, type: "upload", proofHint: "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–æ—Ä–∏—Å/—Å–∫—Ä–∏–Ω—à–æ—Ç (—Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–∞–∫–æ).", link: "" },
    { id: "car_sticker", title: "–ù–∞–∫–ª–µ–π–∫–∞ –Ω–∞ –∞–≤—Ç–æ", reward: 200, type: "upload", proofHint: "–§–æ—Ç–æ –∞–≤—Ç–æ —Å –Ω–∞–∫–ª–µ–π–∫–æ–π –∏ –≥–æ—Ä–æ–¥.", link: "" },
    { id: "invite_friend", title: "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞", reward: 100, type: "ref", proofHint: "–î—Ä—É–≥ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ.", link: "" },
  ],
  raffle: { monthlyPool: "1000 USDT", day: 28 },
};

/** =========================
 *  Mini App helpers
 *  ========================= */
const isTg = !!window.Telegram?.WebApp?.initData;
const tg = window.Telegram?.WebApp ?? null;

// State (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ; —Å–µ—Ä–≤–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç —á–µ—Ä–µ–∑ sendData)
const STATE_KEY = "cryptoatm_state_v1";
const state = loadState();
const nowTs = () => Math.floor(Date.now()/1000);
function loadState(){
  try {
    const s = JSON.parse(localStorage.getItem(STATE_KEY) || "{}");
    return {
      uid: s.uid || (tg?.initDataUnsafe?.user?.id ?? 0),
      uname: s.uname || (tg?.initDataUnsafe?.user?.username ?? ""),
      coins: s.coins ?? 0,
      tickets: s.tickets ?? 0,
      refs: s.refs ?? 0,
      sub: s.sub || { plan: null, until: null, mult: 1.0 },
      clicker: s.clicker || { last: 0, today: 0, dayKey: dayKey() },
      tasks: s.tasks || {}, // id -> {status: "pending|approved|rejected|null", proof?}
      refCode: s.refCode || genRef(),
    };
  } catch(e){ return { coins:0, tickets:0, refs:0, sub:{ plan:null, until:null, mult:1.0 }, clicker:{ last:0, today:0, dayKey:dayKey() }, tasks:{}, refCode: genRef(), uid:0, uname:"" }; }
}
function saveState(){ localStorage.setItem(STATE_KEY, JSON.stringify(state)); }
function dayKey(){ const d=new Date(); return [d.getFullYear(),d.getMonth()+1,d.getDate()].join("-"); }
function genRef(){ return Math.random().toString(36).slice(2,8).toUpperCase(); }

function sendToBot(payload){
  const data = JSON.stringify(payload);
  if(tg){
    tg.sendData(data);
  }else{
    console.log("DEMO sendData ->", data);
  }
}

function fmtDate(ts){
  if(!ts) return "‚Äî";
  const d = new Date(ts*1000);
  return d.toLocaleDateString();
}

function ensureClickerDay(){
  const dk = dayKey();
  if(state.clicker.dayKey !== dk){
    state.clicker.dayKey = dk;
    state.clicker.today = 0;
    saveState();
  }
}

function calcTickets(){
  // –ü—Ä–∏–º–µ—Ä: –±–∏–ª–µ—Ç—ã = coins * sub.mult (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ)
  const t = Math.floor((state.coins || 0) * (state.sub?.mult || 1.0));
  state.tickets = t;
}

/** =========================
 *  UI wiring
 *  ========================= */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
function showTab(id){
  $$("#app main > section").forEach(s => s.classList.add("hidden-el"));
  $("#tab-"+id).classList.remove("hidden-el");
  $$("#app nav .chip").forEach(b => b.classList.remove("tab-active"));
  $(`[data-tab="${id}"]`)?.classList.add("tab-active");
  if(id==="pricing") renderPricing();
  if(id==="tasks") renderTasks();
  if(id==="clicker") updateClickerUI();
  if(id==="ref") renderRef();
  if(id==="raffle") renderRaffle();
}
function openModal(html){
  $("#modalContent").innerHTML = html;
  $("#modal").classList.remove("hidden-el");
}
function closeModal(){ $("#modal").classList.add("hidden-el"); $("#modalContent").innerHTML=""; }

/** =========================
 *  Initial boots
 *  ========================= */
(function boot(){
  if(!isTg){
    $("#demoBadge").classList.remove("hidden-el");
  }else{
    tg.expand();
    tg.disableVerticalSwipes(); // —É–¥–æ–±–Ω–µ–µ —Å–∫—Ä–æ–ª–ª–∏—Ç—å –≤–Ω—É—Ç—Ä–∏
  }

  // Header fast actions
  $("#openPayTop").addEventListener("click", ()=> showTab("pricing"));
  $("#btnStartTasks").addEventListener("click", ()=> showTab("tasks"));
  $("#btnOpenClicker").addEventListener("click", ()=> showTab("clicker"));
  $("#btnSubscribe").addEventListener("click", ()=> showTab("pricing"));
  $("#btnPayCrypto").addEventListener("click", openCryptoModal);
  $("#btnInvoice").addEventListener("click", openInvoiceModal);
  $("#btnSupport").addEventListener("click", openSupportModal);

  // Tabs
  $$("#app nav .chip").forEach(b=> b.addEventListener("click", ()=> showTab(b.dataset.tab)));

  // Modal close
  $("#closeModal").addEventListener("click", closeModal);
  $("#modal").addEventListener("click", (e)=>{ if(e.target.id==="modal") closeModal(); });

  // Render home KPI
  refreshKPI();

  // Render default tab
  showTab("home");

  // Prepare pricing skeleton
  renderPricing();

  // Fill profile
  $("#uid").textContent = state.uid || "‚Äî";
  $("#uname").textContent = state.uname || "‚Äî";
  updateSubStatus();

  // Clicker
  $("#clickBtn").addEventListener("click", onClick);

  // Copy buttons
  $("#copyRef")?.addEventListener("click", ()=> copyInput("#refLink"));
  $("#copyRefApp")?.addEventListener("click", ()=> copyInput("#refLinkApp"));

  // Recalc raffle
  calcTickets();
  refreshKPI();
})();

/** =========================
 *  KPI / Profile
 *  ========================= */
function refreshKPI(){
  $("#coins").textContent = state.coins ?? 0;
  $("#tickets").textContent = state.tickets ?? 0;
  $("#refs").textContent = state.refs ?? 0;
  const chance = estimateChance();
  $("#winChance").textContent = (chance*100).toFixed(1)+"%";
}

function updateSubStatus(){
  const s = state.sub;
  const chip = $("#subStatusChip");
  const untilLabel = s?.until ? new Date(s.until*1000).toLocaleDateString() : "‚Äî";
  chip.textContent = `–ü–æ–¥–ø–∏—Å–∫–∞: ${s?.plan ? s.plan.toUpperCase() : "‚Äî"}`;
  $("#subUntil").textContent = untilLabel;
}

/** =========================
 *  Pricing / Subscribe
 *  ========================= */
function renderPricing(){
  const wrap = $("#tab-pricing .grid-cards");
  wrap.innerHTML = "";
  CONFIG.tariffs.forEach(t=>{
    const perks = t.perks.map(p=>`<li class="flex gap-2 items-start"><span class="text-emerald-300">‚úì</span><span>${p}</span></li>`).join("");
    const active = (state.sub?.plan === t.id) ? `<span class="badge">–∞–∫—Ç–∏–≤–Ω–æ</span>` : ``;
    const html = `
      <div class="col-span-12 md:col-span-4 card p-5 space-y-3">
        <div class="flex items-center justify-between">
          <div class="text-lg font-semibold">${t.name}</div>
          ${active}
        </div>
        <div class="text-3xl font-extrabold">${t.price} ${t.currency}<span class="text-sm text-[var(--muted)]"> / ${t.per}</span></div>
        <div class="text-xs tag">–º–Ω–æ–∂–∏—Ç–µ–ª—å: √ó${t.subMult}</div>
        <ul class="text-sm space-y-2">${perks}</ul>
        <div class="flex gap-2 pt-2">
          <button class="btn btn-primary w-full" onclick='selectPlan("${t.id}")'>–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          <button class="btn btn-muted w-full" onclick='openCryptoModal("${t.id}")'>–û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π</button>
        </div>
      </div>
    `;
    wrap.insertAdjacentHTML("beforeend", html);
  });
}

function selectPlan(planId){
  const t = CONFIG.tariffs.find(x=>x.id===planId);
  if(!t) return;
  openModal(`
    <div>
      <div class="text-lg font-semibold mb-1">–ü–æ–¥–ø–∏—Å–∫–∞: ${t.name}</div>
      <div class="text-sm text-[var(--muted)] mb-3">–°—Ç–æ–∏–º–æ—Å—Ç—å: ${t.price} ${t.currency} / ${t.per}. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)¬ª.</div>
      <div class="flex gap-2">
        <button class="btn btn-primary" onclick='openCryptoModal("${t.id}")'>–û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
        <button class="btn btn-muted" onclick="openInvoiceModal('${t.id}')">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∏–Ω–≤–æ–π—Å</button>
      </div>
    </div>
  `);
  sendToBot({ type: "subscribe_select", plan: planId });
}

/** =========================
 *  Payments
 *  ========================= */
function openCryptoModal(planId=null){
  const nets = CONFIG.networks.map(n=>`
    <div class="glass p-3 rounded-xl">
      <div class="text-sm font-semibold">${n.title}</div>
      <div class="text-xs text-[var(--muted)] monos">${n.address}</div>
      ${n.note?`<div class="text-xs text-[var(--muted)]">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: ${n.note}</div>`:""}
      <button class="btn btn-success mt-2" onclick='confirmCrypto("${n.key}","${planId||""}")'>–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
    </div>`).join("");
  openModal(`
    <div>
      <div class="text-lg font-semibold mb-2">–û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π</div>
      <div class="space-y-2">${nets}</div>
      <div class="text-xs text-[var(--muted)] mt-3">–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ‚Äú–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)‚Äù –∑–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É. –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é.</div>
    </div>
  `);
}
function confirmCrypto(networkKey, planId){
  const ref = `CR-${state.uid}-${Date.now()}`;
  sendToBot({ type: "purchase_intent", method: "crypto", network: networkKey, plan: planId, ref });
  closeModal();
  toast("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É.");
}

function openInvoiceModal(planId=null){
  openModal(`
    <div>
      <div class="text-lg font-semibold mb-2">–ò–Ω–≤–æ–π—Å –Ω–∞ —Ñ–∏—Ä–º—É</div>
      <div class="text-sm text-[var(--muted)]">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Äî –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –≤—ã—Å—Ç–∞–≤–∏—Ç —Å—á—ë—Ç.</div>
      <div class="mt-3 space-y-2">
        <input id="invName" class="w-full p-2 rounded-lg bg-transparent border border-white/10 ring-focus" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ / –§–ò–û"/>
        <input id="invEmail" class="w-full p-2 rounded-lg bg-transparent border border-white/10 ring-focus" placeholder="Email –¥–ª—è –∏–Ω–≤–æ–π—Å–∞"/>
        <input id="invNotes" class="w-full p-2 rounded-lg bg-transparent border border-white/10 ring-focus" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ò–ù–ù/–∞–¥—Ä–µ—Å –∏ —Ç.–ø.)"/>
      </div>
      <button class="btn btn-primary mt-3" onclick='sendInvoice("${planId||""}")'>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  `);
}
function sendInvoice(planId){
  const name = $("#invName").value.trim();
  const email = $("#invEmail").value.trim();
  const notes = $("#invNotes").value.trim();
  if(!name || !email) return toast("–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ email");
  sendToBot({ type: "invoice_request", plan: planId, name, email, notes });
  closeModal();
  toast("–ó–∞—è–≤–∫–∞ –Ω–∞ –∏–Ω–≤–æ–π—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ email.");
}

/** =========================
 *  Clicker
 *  ========================= */
function updateClickerUI(){
  ensureClickerDay();
  $("#clickerCounter").textContent = state.coins;
  const rest = Math.max(0, CONFIG.clicker.dailyLimit - state.clicker.today);
  $("#clickerHint").textContent = `–û—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è: ${rest} –∫–ª–∏–∫–æ–≤ ¬∑ –∫—É–ª–¥–∞—É–Ω ${CONFIG.clicker.cooldownSec}s`;
  renderClickHistory();
}
function onClick(){
  ensureClickerDay();
  const now = nowTs();
  const cd = CONFIG.clicker.cooldownSec;
  if(now - (state.clicker.last||0) < cd){
    const left = cd - (now - (state.clicker.last||0));
    return toast(`–ö—É–ª–¥–∞—É–Ω ${left}s`, true);
  }
  if(state.clicker.today >= CONFIG.clicker.dailyLimit){
    return toast("–î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞.");
  }
  state.clicker.last = now;
  state.clicker.today++;
  state.coins += CONFIG.clicker.coinPerClick;
  calcTickets();
  saveState();
  updateClickerUI();
  refreshKPI();
  // –æ—Ç–ø—Ä–∞–≤–∏–º —Å–æ–±—ã—Ç–∏–µ
  sendToBot({ type: "click", amount: CONFIG.clicker.coinPerClick, at: now });
}
function renderClickHistory(){
  const box = $("#clickHistory");
  const items = Math.min(state.clicker.today, 10);
  let html="";
  for(let i=0;i<items;i++) html += `<div>+${CONFIG.clicker.coinPerClick} CAT</div>`;
  box.innerHTML = html || "<div>–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫!</div>";
}

/** =========================
 *  Tasks
 *  ========================= */
function renderTasks(){
  const wrap = $("#tasksList");
  wrap.innerHTML = "";
  CONFIG.tasks.forEach(task=>{
    const st = state.tasks[task.id]?.status || "null";
    const statusChip = renderTaskStatus(st);
    const proof = state.tasks[task.id]?.proof || "";
    wrap.insertAdjacentHTML("beforeend", `
      <div class="glass p-4 rounded-xl">
        <div class="flex items-center justify-between gap-2">
          <div class="font-semibold">${task.title}</div>
          ${statusChip}
        </div>
        <div class="text-xs text-[var(--muted)] mt-1">–ù–∞–≥—Ä–∞–¥–∞: +${task.reward} CAT</div>
        ${task.link ? `<a class="text-cyan-300 text-sm underline" href="${task.link}" target="_blank" rel="noreferrer">–ü–µ—Ä–µ–π—Ç–∏</a>` : ""}
        <div class="mt-3 space-y-2">
          <input id="proof_${task.id}" class="w-full p-2 rounded-lg bg-transparent border border-white/10 ring-focus" placeholder="${task.proofHint}" value="${proof}"/>
          <div class="flex gap-2">
            <button class="btn btn-primary" onclick='submitProof("${task.id}")'>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            <button class="btn btn-muted" onclick='markTaskDone("${task.id}")'>–Ø –≤—ã–ø–æ–ª–Ω–∏–ª(–∞)</button>
          </div>
        </div>
      </div>
    `);
  });
}
function renderTaskStatus(st){
  if(st==="approved") return `<span class="badge" style="border-color:#34d399;color:#d1fae5">–ø—Ä–∏–Ω—è—Ç–æ</span>`;
  if(st==="pending") return `<span class="badge">–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>`;
  if(st==="rejected") return `<span class="badge" style="border-color:#fb7185;color:#fecdd3">–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>`;
  return `<span class="badge">–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>`;
}
function submitProof(taskId){
  const v = $(`#proof_${taskId}`).value.trim();
  if(!v) return toast("–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É/–ø–æ—è—Å–Ω–µ–Ω–∏–µ –∫ –ø—Ä—É—Ñ—É");
  state.tasks[taskId] = { status: "pending", proof: v };
  saveState();
  renderTasks();
  sendToBot({ type: "task_submit", id: taskId, proof: v });
  toast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É.");
}
function markTaskDone(taskId){
  // –±—ã—Å—Ç—Ä—ã–π ‚Äú—è —Å–¥–µ–ª–∞–ª‚Äù ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ pending –¥–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  state.tasks[taskId] = { status: "pending", proof: state.tasks[taskId]?.proof || "" };
  saveState();
  renderTasks();
  sendToBot({ type: "task_mark", id: taskId });
  toast("–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é.");
}

/** =========================
 *  Raffle
 *  ========================= */
function renderRaffle(){
  const d = new Date();
  $("#raffleMonth").textContent = `–º–µ—Å—è—Ü ‚Äî ${d.toLocaleString('ru-RU', {month:'long', year:'numeric'})}`;
  $("#prizePool").textContent = CONFIG.raffle.monthlyPool;
  $("#yourTickets").textContent = state.tickets;
  $("#yourChance").textContent = (estimateChance()*100).toFixed(2) + "%";
}
function estimateChance(){
  // –∑–∞–≥–ª—É—à–∫–∞: —Å—á–∏—Ç–∞–µ–º –æ–±—â–∏–π –±–∞–Ω–∫ –∫–∞–∫ 100k –±–∏–ª–µ—Ç–æ–≤
  const total = 100000;
  const me = state.tickets || 0;
  return Math.min(1, me / total);
}

/** =========================
 *  Referral
 *  ========================= */
function renderRef(){
  $("#botU1").textContent = CONFIG.botUsername;
  $("#botU2").textContent = CONFIG.botUsername;
  $("#refCode1").textContent = state.refCode;
  $("#refCode2").textContent = state.refCode;
  const link1 = `https://t.me/${CONFIG.botUsername}?start=ref_${state.refCode}`;
  const link2 = `https://t.me/${CONFIG.botUsername}?startapp=ref_${state.refCode}`;
  $("#refLink").value = link1;
  $("#refLinkApp").value = link2;
  // –°–æ–æ–±—â–∏–º –±–æ—Ç—É, –µ—Å–ª–∏ –º–∏–Ω–∏-–∞–ø–ø –æ—Ç–∫—Ä—ã—Ç–æ —Å ref
  const sp = new URLSearchParams(location.search);
  const refOpen = sp.get("ref");
  if(refOpen) sendToBot({ type: "ref_open", code: refOpen });
}
function copyInput(sel){
  const el = $(sel);
  el.select(); el.setSelectionRange(0, el.value.length);
  document.execCommand("copy");
  toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ.");
}

/** =========================
 *  Support
 *  ========================= */
function openSupportModal(){
  openModal(`
    <div>
      <div class="text-lg font-semibold mb-2">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
      <div class="text-sm text-[var(--muted)] mb-2">–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É, –º—ã –æ—Ç–≤–µ—Ç–∏–º –≤–∞–º –≤ Telegram.</div>
      <textarea id="supText" rows="4" class="w-full p-2 rounded-lg bg-transparent border border-white/10 ring-focus" placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å..."></textarea>
      <button class="btn btn-primary mt-3" onclick="sendSupport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  `);
}
function sendSupport(){
  const txt = $("#supText").value.trim();
  if(!txt) return toast("–û–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å");
  sendToBot({ type: "support", text: txt });
  closeModal();
  toast("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —á–∞—Ç–µ.");
}

/** =========================
 *  Toast
 *  ========================= */
function toast(msg, danger=false){
  const el = document.createElement("div");
  el.className = "fixed left-1/2 -translate-x-1/2 bottom-6 z-50 px-4 py-2 rounded-xl shadow-soft " + (danger ? "bg-[rgba(251,113,133,.22)] border border-[rgba(251,113,133,.4)]" : "glass");
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(()=>{ el.remove(); }, 2200);
}

/** =========================
 *  Subscriptions activation (server ‚Üí client)
 *  =========================
 *  –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é web_app_data
 *  –∏–ª–∏ –æ–±—ã—á–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (–ø–æ –∂–µ–ª–∞–Ω–∏—é).
 *  –ù–∏–∂–µ ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∑–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∞:
 */
// window.__activateSub("pro", 30) // —Ç–µ—Å—Ç: –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 30 –¥–Ω–µ–π
window.__activateSub = function(plan, days){
  const t = CONFIG.tariffs.find(x=>x.id===plan); if(!t) return;
  const until = Math.floor(Date.now()/1000) + days*86400;
  state.sub = { plan, until, mult: t.subMult };
  saveState();
  updateSubStatus();
  calcTickets();
  refreshKPI();
  toast("–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (DEMO).");
};

// window.__approveTask("inst_follow", true) // —Ç–µ—Å—Ç: –ø—Ä–∏–Ω—è—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å
window.__approveTask = function(taskId, ok=true){
  const cur = state.tasks[taskId] || {};
  cur.status = ok ? "approved" : "rejected";
  state.tasks[taskId] = cur;
  if(ok){
    const task = CONFIG.tasks.find(t=>t.id===taskId);
    if(task) { state.coins += task.reward; calcTickets(); }
  }
  saveState(); renderTasks(); refreshKPI();
  toast(ok ? "–ó–∞–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ (DEMO)" : "–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ (DEMO)");
};
</script>
</body>
</html>

