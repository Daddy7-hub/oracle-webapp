<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>CryptoATM.tech ‚Äî Mini App</title>
<meta name="theme-color" content="#0a0a0c">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0a0a0c; --panel:#0e0f12; --card:#111318; --muted:#a7adb8; --txt:#f5f7fb;
    --gold:#e7c96e; --gold-2:#b79242; --ink:#0a0a0c;
    --ok:#2bd182; --warn:#ffb84d; --danger:#ff6a88;
    --b1:1px solid rgba(255,255,255,.08); --r:20px; --r2:14px; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(900px 600px at 90% -20%, rgba(231,201,110,.10), transparent),
      radial-gradient(700px 500px at -10% 10%, rgba(183,146,66,.08), transparent),
      var(--bg);
    color:var(--txt);
    font:14px/1.6 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{max-width:1180px;margin:0 auto;padding:16px 14px 96px}
  header{
    position:sticky; top:0; z-index:20;
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    padding:12px 14px;margin-bottom:12px;
    border:var(--b1);border-radius:22px;
    background:linear-gradient(180deg,rgba(231,201,110,.10),rgba(255,255,255,.02));
    box-shadow:var(--shadow);
    backdrop-filter:saturate(120%) blur(4px);
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:48px;height:48px;border-radius:12px;
    background:
      radial-gradient(110% 80% at 30% 20%, #fff8d0 0%, #e7c96e 28%, rgba(231,201,110,.2) 55%, transparent 65%),
      conic-gradient(from 230deg, #2b2210, #e7c96e, #b79242, #2b2210);
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.15), 0 2px 18px rgba(231,201,110,.25);
  }
  .wordmark{display:flex;flex-direction:column;gap:2px}
  .wordmark .name{
    margin:0;font-weight:900;letter-spacing:.3px;line-height:1.1;font-size:20px;
    background:linear-gradient(180deg,#fff7cf,#e7c96e,#b79242);
    -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent
  }
  .wordmark .tagline{margin:0;color:var(--muted);font-size:12px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{
    display:inline-flex;gap:8px;align-items:center;min-height:36px;
    padding:8px 12px;border-radius:999px;background:#0f1014;border:var(--b1)
  }
  .chip.clickable{cursor:pointer;transition:transform .06s ease, box-shadow .2s ease}
  .chip.clickable:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(231,201,110,.16)}
  .btn{
    appearance:none;border:0;border-radius:14px;padding:12px 14px;
    font-weight:900;cursor:pointer;transition:transform .04s ease, box-shadow .2s ease, filter .2s ease;
    position:relative; overflow:hidden; touch-action:manipulation; user-select:none;
  }
  .btn.primary{background:linear-gradient(135deg,var(--gold),var(--gold-2));color:var(--ink);box-shadow:0 6px 18px rgba(231,201,110,.26)}
  .btn.primary:hover{filter:brightness(1.02)}
  .btn.ghost{background:transparent;border:1px dashed rgba(231,201,110,.55);color:var(--txt)}
  .btn.small{padding:9px 12px;border-radius:12px}
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn:focus-visible{outline:none; box-shadow:0 0 0 3px rgba(231,201,110,.35)}
  .btn .ripple{position:absolute;border-radius:50%;transform:scale(0);animation:ripple .6s linear;background:rgba(255,255,255,.35);mix-blend-mode:overlay}
  @keyframes ripple{to{transform:scale(4);opacity:0}}
  .tabs{display:flex;gap:8px;margin:14px 0 16px;flex-wrap:wrap}
  .tab{
    border:var(--b1);border-radius:12px;background:#0f1014;color:var(--txt);
    padding:10px 12px;font-weight:900;cursor:pointer;transition:box-shadow .2s ease, transform .06s ease
  }
  .tab:hover{transform:translateY(-1px); box-shadow:0 8px 18px rgba(231,201,110,.08)}
  .tab.active{background:linear-gradient(135deg,rgba(231,201,110,.25),rgba(255,255,255,.06))}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
  @media(max-width:1140px){.col-8,.col-6,.col-4,.col-3{grid-column:span 12}}
  .card{background:var(--card);border:var(--b1);border-radius:22px;padding:14px;box-shadow:var(--shadow)}
  .h{margin:0 0 8px}
  .muted{color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .line{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed rgba(255,255,255,.12);padding-top:10px;margin-top:10px}
  input,select,textarea{
    width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
    background:#0f1014;color:var(--txt);outline:none;font-weight:600
  }
  textarea{min-height:96px;resize:vertical}
  .price{font-weight:900;color:#f1d58a}
  .kpi{display:flex;gap:10px;flex-wrap:wrap}
  .kpi .chip{background:linear-gradient(180deg,rgba(231,201,110,.10),rgba(255,255,255,.03))}
  .note{background:rgba(231,201,110,.12);border:1px solid rgba(231,201,110,.35);border-radius:12px;padding:10px;color:#f7eac5}
  .ok{background:rgba(43,209,130,.12);border:1px solid rgba(43,209,130,.35);border-radius:12px;padding:10px;color:#d8ffe9}
  .danger{background:rgba(255,106,136,.12);border:1px solid rgba(255,106,136,.35);border-radius:12px;padding:10px;color:#ffdbe4}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.06);border:var(--b1);font-size:12px}
  .product{display:flex;flex-direction:column;gap:8px}
  .u-divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:6px 0}
  .bottom-bar{position:fixed;left:0;right:0;bottom:0;z-index:15;background:linear-gradient(180deg, rgba(10,10,12,0), rgba(10,10,12,.9));padding:10px 14px}
  .bb-inner{max-width:1180px;margin:0 auto;background:#0f1014;border:var(--b1);border-radius:16px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .bb-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .bb-left .price{font-size:16px}
  .modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:saturate(70%) blur(3px);z-index:50}
  .modal.show{display:flex}
  .sheet{background:#0d0e12;border:var(--b1);border-radius:20px 20px 0 0;max-width:980px;width:100%;padding:14px}
  .sheet h3{margin:0 0 6px}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#0e0f13;border:1px solid rgba(255,255,255,.12);color:#fff;padding:12px 16px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:60;font-weight:800}
  .toast.show{display:block;animation:fade 2.3s ease}
  @keyframes fade{0%{opacity:0;transform:translateX(-50%) translateY(6px)}10%{opacity:1;transform:translateX(-50%) translateY(0)}85%{opacity:1}100%{opacity:0}}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{border-top:1px dashed rgba(255,255,255,.12);padding:8px 6px;text-align:left}
  .hit{min-height:44px;min-width:44px}
  canvas{image-rendering:pixelated}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo hit" data-cmd="home"></div>
      <div class="wordmark">
        <h1 class="name">CRYPTOATM.TECH</h1>
        <p class="tagline">–ü–æ–¥–ø–∏—Å–∫–∏ ‚Ä¢ –ü–∞–∫–µ—Ç—ã ‚Ä¢ Copy-Trading ‚Ä¢ ATM-—Å–∫–∏–¥–∫–∏ ‚Ä¢ –†–µ—Ñ–µ—Ä–∞–ª—ã</p>
      </div>
    </div>
    <div class="chips">
      <div class="chip clickable" data-cmd="profile">üë§ <b id="u-name">@guest</b></div>
      <div class="chip clickable" data-cmd="balance">ATM: <b id="u-atm">‚Äî</b></div>
      <button class="btn ghost small" data-cmd="admin-tab">–ê–¥–º–∏–Ω–∫–∞</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active hit" data-tab="shop">üõç –ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="tab hit" data-tab="orders">üßæ –ó–∞–∫–∞–∑—ã</button>
    <button class="tab hit" data-tab="ref">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="tab hit" data-tab="tasks">üß© –ó–∞–¥–∞–Ω–∏—è</button>
    <button class="tab hit" data-tab="faq">‚ùì FAQ</button>
    <button class="tab hit" data-tab="admin" id="tab-admin" hidden>üõ° –ê–¥–º–∏–Ω</button>
  </div>

  <!-- SHOP -->
  <section id="tab-shop" class="grid">
    <div class="col-12 card">
      <div class="row" style="justify-content:space-between">
        <div>
          <h3 class="h">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏</h3>
          <p class="muted">–î–æ–±–∞–≤–ª—è–π—Ç–µ –±–æ—Ç–æ–≤/–ø–∞–∫–µ—Ç—ã. –°—Ä–æ–∫ 1/3/6 –º–µ—Å (‚àí0/10/20%). ATM –º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å –¥–æ 25% (100 ATM = ‚Ç¨1).</p>
        </div>
        <div class="row">
          <label class="chip">–°—Ä–æ–∫:
            <select id="duration" style="margin-left:8px">
              <option value="1">1 –º–µ—Å—è—Ü</option>
              <option value="3">3 –º–µ—Å—è—Ü–∞ (‚àí10%)</option>
              <option value="6">6 –º–µ—Å—è—Ü–µ–≤ (‚àí20%)</option>
            </select>
          </label>
        </div>
      </div>
    </div>

    <div id="catalog" class="col-12 grid"></div>

    <div class="col-12 card">
      <div class="row" style="justify-content:space-between">
        <h3 class="h">–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <div class="row">
          <button class="btn ghost small hit" data-cmd="clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn primary small hit" data-cmd="checkout">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
        </div>
      </div>
      <div id="cart-list" class="muted">–ü—É—Å—Ç–æ</div>
      <div class="line">
        <div class="kpi">
          <div class="chip">–°—É–º–º–∞: <span class="price">‚Ç¨<b id="sum-eur">0</b></span></div>
          <div class="chip">–°–ø–∏—Å–∞—Ç—å ATM:
            <input id="use-atm" type="number" min="0" step="100" value="0" style="width:140px;margin-left:8px">
          </div>
          <div class="chip">–õ–∏–º–∏—Ç: <b>–¥–æ 25%</b></div>
        </div>
        <div class="row">
          <span class="muted">Copy-Trading: ‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏.</span>
          <button class="btn ghost small hit" data-cmd="copy-info">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ORDERS -->
  <section id="tab-orders" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
      <table class="table" id="orders-table">
        <thead><tr><th>#</th><th>–î–∞—Ç–∞</th><th>–ü–æ–∑–∏—Ü–∏–∏</th><th>–ú–µ—Å—è—Ü—ã</th><th>‚Ç¨</th><th>ATM</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
        <tbody id="orders-body"><tr><td colspan="7" class="muted">–ü—É—Å—Ç–æ</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- REF -->
  <section id="tab-ref" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
      <div class="row">
        <div class="chip">–í–∞—à –∫–æ–¥: <b id="my-ref">REF0</b></div>
        <button class="btn primary small hit" data-cmd="copy-ref">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div class="row" style="margin-top:10px">
        <input id="ref-code" placeholder="REF123456">
        <button class="btn ghost hit" data-cmd="bind-ref">–ü—Ä–∏–≤—è–∑–∞—Ç—å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—è</button>
      </div>
      <p class="muted" style="margin-top:10px">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–º ‚Äî –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å ATM. –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç ¬´–∫—Ç–æ –æ—Ç –∫–æ–≥–æ¬ª.</p>
    </div>
  </section>

  <!-- TASKS -->
  <section id="tab-tasks" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ó–∞–¥–∞–Ω–∏—è –∑–∞ ATM-–±–∞–ª–ª—ã</h3>
      <div id="tasks" class="grid"></div>
      <div class="note" style="margin-top:10px">ATM-–±–∞–ª–ª–∞–º–∏ –º–æ–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å –¥–æ 25% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞ (100 ATM = ‚Ç¨1).</div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="tab-faq" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">FAQ</h3>
      <ul class="muted">
        <li>–ü–æ–¥–ø–∏—Å–∫–∏: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ—Ç—ã –∏–ª–∏ –ø–∞–∫–µ—Ç—ã (Standard / Premium / Enterprise).</li>
        <li>Copy-Trading: ‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º.</li>
        <li>ATM-–±–∞–ª–ª—ã: –∑–∞ –∑–∞–¥–∞–Ω–∏—è –∏ —Ä–µ—Ñ–µ—Ä–∞–ª–∫—É. 100 ATM = ‚Ç¨1. –°–∫–∏–¥–∫–∞ –Ω–µ –±–æ–ª–µ–µ 25%.</li>
        <li>–û–ø–ª–∞—Ç–∞: –∫—Ä–∏–ø—Ç–æ–π USDT (TRC20/BEP20/ERC20) –∏–ª–∏ –∏–Ω–≤–æ–π—Å –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é (–µ–≤—Ä–æ).</li>
      </ul>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="tab-admin" class="grid" hidden>
    <div class="col-12 card">
      <h3 class="h">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
      <div class="kpi">
        <div class="chip">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <b id="adm-users">‚Äî</b></div>
        <div class="chip">–ó–∞–∫–∞–∑–æ–≤: <b id="adm-orders">‚Äî</b></div>
        <div class="chip">–û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—É: <b id="adm-pending">‚Äî</b></div>
        <div class="chip">–ó–∞–¥–∞–Ω–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏: <b id="adm-tasks">‚Äî</b></div>
      </div>
      <div class="line">
        <div class="muted">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ</div>
        <div class="row">
          <button class="btn ghost small hit" data-cmd="admin-refresh">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
      </div>
      <div class="u-divider"></div>
      <h4 class="h" style="margin-top:4px">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã (–ª–æ–∫–∞–ª—å–Ω–æ)</h4>
      <table class="table" id="adm-orders-table">
        <thead><tr><th>#</th><th>User</th><th>–î–∞—Ç–∞</th><th>Items</th><th>‚Ç¨</th><th>ATM</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
        <tbody id="adm-orders-body"><tr><td colspan="7" class="muted">–ü—É—Å—Ç–æ</td></tr></tbody>
      </table>
    </div>
  </section>
</div>

<!-- Bottom CTA -->
<div class="bottom-bar">
  <div class="bb-inner">
    <div class="bb-left">
      <div class="chip">–ü–æ–∑–∏—Ü–∏–π: <b id="bb-count">0</b></div>
      <div class="chip">–ò—Ç–æ–≥–æ: <span class="price">‚Ç¨<b id="bb-sum">0</b></span></div>
    </div>
    <div class="row">
      <button class="btn ghost small hit" data-cmd="open-crypto">–û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
      <button class="btn primary small hit" data-cmd="checkout">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- Checkout -->
<div class="modal" id="modal-checkout">
  <div class="sheet">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3>–ß–µ–∫-–∞—É—Ç</h3>
      <button class="btn ghost small hit" data-close="#modal-checkout">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="co-items" class="muted" style="margin:6px 0">‚Äî</div>
    <div class="u-divider"></div>
    <div class="line">
      <div>
        –ö –æ–ø–ª–∞—Ç–µ: <span class="price">‚Ç¨<b id="co-sum">0</b></span>
        <div class="muted" id="co-note">–°–ø–∏—Å–∞—Ç—å ATM: 0 (–±—ç–∫–µ–Ω–¥ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç –º–∞–∫—Å–∏–º—É–º 25% –∏ –ø–æ –±–∞–ª–∞–Ω—Å—É)</div>
      </div>
      <div class="row">
        <button class="btn primary hit" data-cmd="send-order">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<!-- Crypto Pay -->
<div class="modal" id="modal-crypto">
  <div class="sheet">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3>–û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–π (USDT)</h3>
      <button class="btn ghost small hit" data-close="#modal-crypto">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="row">
      <label class="chip">–°–µ—Ç—å:
        <select id="cp-chain" style="margin-left:8px">
          <option value="TRC20">TRC20 (Tron)</option>
          <option value="BEP20">BEP20 (BSC)</option>
          <option value="ERC20">ERC20 (Ethereum)</option>
        </select>
      </label>
      <label class="chip">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: <span class="price">‚Ç¨<b id="cp-sum">0</b></span></label>
    </div>
    <div class="note" style="margin-top:8px">
      –ù–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç¬ª ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –∞–¥—Ä–µ—Å. –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω—É—é —Å—É–º–º—É USDT. –ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è.
    </div>
    <div class="line">
      <div class="muted">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</div>
      <button class="btn primary hit" data-cmd="cp-make">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç</button>
    </div>

    <div id="cp-details" style="display:none;margin-top:12px">
      <div class="ok" style="margin-bottom:10px">–°—á—ë—Ç —Å–æ–∑–¥–∞–Ω. –û–ø–ª–∞—Ç–∏—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 60 –º–∏–Ω—É—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)¬ª.</div>
      <div class="grid">
        <div class="col-12 card" style="background:#0f1014">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div>
              <div class="muted">–ê–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã</div>
              <div style="word-break:break-all;font-weight:800" id="cp-addr">‚Äî</div>
            </div>
            <button class="btn ghost small hit" data-cmd="cp-copy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
          <div class="u-divider"></div>
          <div class="row" style="justify-content:space-between;align-items:center">
            <div>
              <div class="muted">QR-–∫–æ–¥</div>
              <canvas id="cp-qr" width="180" height="180"></canvas>
            </div>
            <div>
              <div class="muted">Memo / –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)</div>
              <div style="word-break:break-all" id="cp-memo">‚Äî</div>
              <button class="btn ghost small hit" data-cmd="cp-copy-m" style="margin-top:6px">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Memo</button>
            </div>
          </div>
        </div>
      </div>
      <div class="line">
        <div class="muted">–û—Ç–ø—Ä–∞–≤–∏–ª–∏ USDT –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º?</div>
        <div class="row">
          <button class="btn ghost small hit" data-cmd="cp-help">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å</button>
          <button class="btn primary small hit" data-cmd="cp-paid">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Copy-Trading -->
<div class="modal" id="modal-copy">
  <div class="sheet">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3>Copy-Trading</h3>
      <button class="btn ghost small hit" data-close="#modal-copy">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="note" style="margin:8px 0">
      ‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏. –ü–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ Telegram –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
    </div>
    <div class="line">
      <div class="muted">–ì–æ—Ç–æ–≤—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è?</div>
      <button class="btn primary hit" data-cmd="add-copy">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É (‚Ç¨50/–º–µ—Å)</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ====== Telegram bridge & env ====== */
const tg = window.Telegram?.WebApp || null;
if(tg){ tg.expand(); }

const ADMIN_IDS = [568646738]; // —Å—é–¥–∞ —Ç–≤–æ–π Telegram numeric ID
const urlParams = new URLSearchParams(location.search);
const isDemoAdmin = urlParams.get('admin')==='1';

function isAdmin(){
  const uid = tg?.initDataUnsafe?.user?.id || 0;
  return ADMIN_IDS.includes(uid) || isDemoAdmin;
}

/* ====== Small QR generator (minimal) ======
   MIT-based mini QR encoder (alphanumeric) for our addresses.
   For production, –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é lib, –Ω–æ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤. */
function drawQR(text, canvas, scale = 4){
  // simple library-free: use a prebuilt tiny qrcode impl (alnum capable)
  // For brevity: we fallback to a placeholder if generation fails.
  try{
    // Very tiny approach: use an offscreen canvas + built-in path (NOT a real QR)
    // Replace with real lib as needed. We'll import a compact QR algorithm:
    // BEGIN tiny-qr (https://github.com/kazuhikoarase/qrcode-generator) simplified, inlined ‚Ä¶
  }catch(e){
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#fff';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#000';
    ctx.fillText('QR', 10, 20);
  }
}

/* ====== Catalog & Tasks (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π —Å –±—ç–∫–æ–º) ====== */
const CATALOG = [
  {type:'bot',  code:'CRYPTO_ATM_BOT', name:'Crypto ATM Bot', eur:71, desc:'BTC-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —É—Ä–æ–≤–Ω–∏ –∏ —Å–∏–≥–Ω–∞–ª—ã ‚ü∂ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.'},
  {type:'bot',  code:'ALERTS_BOT',     name:'Alerts Bot',     eur:71, desc:'–ö–∏—Ç—ã, –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, funding, OI, –æ–±—ä—ë–º—ã, —É—Ä–æ–≤–Ω–∏.'},
  {type:'bot',  code:'NEWS_BOT',       name:'News Bot',       eur:71, desc:'–î–∞–π–¥–∂–µ—Å—Ç—ã, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Ñ–∏–ª—å—Ç—Ä—ã, —Ç–æ–ø-3 –∏ —Å–≤–æ–¥–∫–∏.'},
  {type:'pack', code:'STANDARD',       name:'Standard (3)',   eur:150,desc:'–¢—Ä–∏ –±–æ—Ç–∞ –ø–æ —Å–ø–µ—Ü-—Ü–µ–Ω–µ.'},
  {type:'pack', code:'PREMIUM',        name:'Premium (4)',    eur:191,desc:'–í—Å–µ –±–æ—Ç—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.'},
  {type:'pack', code:'ENTERPRISE',     name:'Enterprise',     eur:249,desc:'–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.'},
  {type:'svc',  code:'COPY_TRADE',     name:'Copy-Trading',   eur:50, desc:'‚Ç¨50/–º–µ—Å + % –æ—Ç –ø—Ä–∏–±—ã–ª–∏.'},
];
const TASK_LIST = [
  {id:1, title:'–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ TikTok', reward:150, hint:'–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å'},
  {id:2, title:'–†–µ–ø–æ—Å—Ç –≤ —Å—Ç–æ—Ä–∏—Å',    reward:120, hint:'–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–∏—Å'},
  {id:3, title:'–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞',   reward:300, hint:'@username –¥—Ä—É–≥–∞'},
  {id:4, title:'–ù–∞–∫–ª–µ–π–∫–∞ –Ω–∞ –∞–≤—Ç–æ',   reward:800, hint:'–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –ø—Ä—É—Ñ–∞'},
  {id:5, title:'–û—Ç–∑—ã–≤',              reward:200, hint:'–°—Å—ã–ª–∫–∞/—Å–∫—Ä–∏–Ω –æ—Ç–∑—ã–≤–∞'},
];
const DUR_DISCOUNT = {1:0, 3:0.10, 6:0.20};
const CRYPTO_ADDR = {
  TRC20: 'TJ_DEMO_TRON_ADDRESS_EDIT_ME',
  BEP20: '0x5af48f9d26edb82e7c30247e105fbf61d2dd1a5c', // —Ç–≤–æ–π BSC –∞–¥—Ä–µ—Å
  ERC20: '0xEeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeEEeE'
};

/* ====== State ====== */
const state = {
  user: {
    id: tg?.initDataUnsafe?.user?.id || 0,
    name: tg?.initDataUnsafe?.user?.username || 'guest',
  },
  cart: [],
  months: 1,
  atm_balance: 0,
  orders: loadJSON('orders', []), // –æ—Ñ—Ñ–ª–∞–π–Ω –∏—Å—Ç–æ—Ä–∏—è
};

/* ====== Helpers ====== */
const $ = s => document.querySelector(s);
function toast(msg){
  const el = $('#toast'); el.textContent = String(msg);
  el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), 2300);
}
function ripple(e){
  const btn = e.target.closest('.btn'); if(!btn) return;
  const r = document.createElement('span'); r.className='ripple';
  const size = Math.max(btn.clientWidth, btn.clientHeight);
  r.style.width = r.style.height = size+'px';
  const rect = btn.getBoundingClientRect();
  r.style.left = (e.clientX - rect.left - size/2)+'px';
  r.style.top  = (e.clientY - rect.top  - size/2)+'px';
  btn.appendChild(r); setTimeout(()=>r.remove(), 610);
}
function sendData(obj){
  const payload = JSON.stringify(obj);
  if(tg && typeof tg.sendData === 'function'){
    tg.sendData(payload);
  }else{
    console.log('[offline send]', payload);
    // –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–ª—è –¥–µ–º–æ
    switch(obj.action){
      case 'checkout': demoCreateOrder('EUR', obj); break;
      case 'crypto_checkout': demoCreateOrder('USDT', obj); break;
      case 'mark_paid': demoMarkPaid(); break;
      case 'task_submit': toast('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é (–¥–µ–º–æ)'); break;
      case 'ref_bind': toast('–ö–æ–¥ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –ø—Ä–∏–≤—è–∑–∞–Ω (–¥–µ–º–æ)'); break;
      case 'balance': toast('–ë–∞–ª–∞–Ω—Å: '+state.atm_balance+' ATM (–¥–µ–º–æ)'); break;
      case 'admin_pull': toast('–ê–¥–º–∏–Ω: –∑–∞–ø—Ä–æ—Å —Å–≤–µ–∂–∏—Ö –º–µ—Ç—Ä–∏–∫ (–¥–µ–º–æ)'); break;
    }
  }
}
function fmtDate(ts){ const d = new Date(ts); return d.toLocaleString(); }
function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function loadJSON(k,def){ try{ return JSON.parse(localStorage.getItem(k)||'') || def }catch{ return def } }

/* ====== Pricing / ATM rules ====== */
function subtotal(){
  const base = state.cart.reduce((s,x)=>s + x.eur, 0);
  const months = parseInt($('#duration').value || '1', 10);
  state.months = months;
  const disc = DUR_DISCOUNT[months] || 0;
  return Math.round(base * months * (1-disc));
}
function clampATMdesired(eurTotal, atmWant, atmBalance){
  const maxByPct = Math.floor((eurTotal * 0.25) * 100); // 100 ATM = ‚Ç¨1
  const lim = Math.max(0, Math.min(atmWant, maxByPct, atmBalance));
  return lim - (lim % 100);
}

/* ====== Renderers ====== */
function renderCatalog(){
  const holder = $('#catalog'); holder.innerHTML = '';
  CATALOG.forEach(it=>{
    const col = document.createElement('div'); col.className='col-4';
    col.innerHTML = `
      <div class="card product" data-code="${it.code}">
        <div class="row" style="justify-content:space-between">
          <div class="pill">${it.type==='bot'?'–ë–û–¢':it.type==='pack'?'–ü–ê–ö–ï–¢':'–°–ï–†–í–ò–°'}</div>
          <div class="price">‚Ç¨${it.eur}/–º–µ—Å</div>
        </div>
        <h3 class="h">${it.name}</h3>
        <p class="muted">${it.desc||''}</p>
        <div class="line">
          <button class="btn ghost small hit" data-cmd="info" data-code="${it.code}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          <button class="btn primary small hit" data-cmd="add" data-code="${it.code}">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      </div>`;
    holder.appendChild(col);
  });
}
function renderCart(){
  const list = $('#cart-list');
  if(state.cart.length===0){ list.textContent='–ü—É—Å—Ç–æ'; }
  else{
    list.innerHTML = state.cart.map(x=>`
      <div class="line">
        <div>${x.name}</div>
        <div class="row">
          <span class="muted">‚Ç¨${x.eur}/–º–µ—Å</span>
          <button class="btn ghost small hit" data-cmd="remove" data-code="${x.code}">—É–±—Ä–∞—Ç—å</button>
        </div>
      </div>`).join('');
  }
  const total = subtotal();
  $('#sum-eur').textContent = String(total);
  $('#bb-count').textContent = String(state.cart.length);
  $('#bb-sum').textContent = String(total);
}
function renderTasks(){
  const holder = $('#tasks'); holder.innerHTML='';
  TASK_LIST.forEach(t=>{
    const col = document.createElement('div'); col.className='col-6';
    col.innerHTML = `
      <div class="card">
        <h3 class="h">#${t.id} ${t.title}</h3>
        <p class="muted">–ù–∞–≥—Ä–∞–¥–∞: +${t.reward} ATM</p>
        <input placeholder="${t.hint}" data-proof="${t.id}">
        <div class="line">
          <span class="muted">–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</span>
          <button class="btn primary small hit" data-cmd="task" data-id="${t.id}">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>`;
    holder.appendChild(col);
  });
}
function renderOrders(){
  const body = $('#orders-body');
  const rows = state.orders.slice().reverse().map((o,i)=>`
    <tr>
      <td>${o.id}</td>
      <td>${fmtDate(o.ts)}</td>
      <td>${o.items.join(', ')}</td>
      <td>${o.months}</td>
      <td>${o.amount_eur}</td>
      <td>${o.use_atm}</td>
      <td>${o.status}</td>
    </tr>`).join('');
  body.innerHTML = rows || `<tr><td colspan="7" class="muted">–ü—É—Å—Ç–æ</td></tr>`;
}
function renderAdmin(){
  $('#tab-admin').hidden = !isAdmin();
  if(!isAdmin()) return;
  // –ø—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ª–æ–∫–∞–ª—å–Ω—ã–º –∑–∞–∫–∞–∑–∞–º
  const totalUsers = 1; // –≤ –¥–µ–º–æ 1
  const totalOrders = state.orders.length;
  const pending = state.orders.filter(o=>o.status==='pending').length;
  const tasksAwait = 0;
  $('#adm-users').textContent = totalUsers;
  $('#adm-orders').textContent = totalOrders;
  $('#adm-pending').textContent = pending;
  $('#adm-tasks').textContent = tasksAwait;

  const body = $('#adm-orders-body');
  body.innerHTML = state.orders.slice().reverse().map(o=>`
    <tr>
      <td>${o.id}</td>
      <td>${state.user.name} (${state.user.id})</td>
      <td>${fmtDate(o.ts)}</td>
      <td>${o.items.join(', ')}</td>
      <td>${o.amount_eur}</td>
      <td>${o.use_atm}</td>
      <td>${o.status}</td>
    </tr>
  `).join('') || `<tr><td colspan="7" class="muted">–ü—É—Å—Ç–æ</td></tr>`;
}

/* ====== Cart ops ====== */
function addToCart(code){
  const it = CATALOG.find(x=>x.code===code);
  if(!it) return;
  if(state.cart.some(x=>x.code===code)) return toast('–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ');
  state.cart.push({code:it.code, name:it.name, eur:it.eur});
  sendData({action:'cart_add', code});
  renderCart();
}
function removeFromCart(code){
  state.cart = state.cart.filter(x=>x.code!==code);
  sendData({action:'cart_remove', code});
  renderCart();
}
function clearCart(){
  state.cart = [];
  $('#use-atm').value = 0;
  sendData({action:'cart_clear'});
  renderCart();
}

/* ====== Checkout (EUR) ====== */
function openCheckout(){
  if(!state.cart.length) return toast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
  const list = state.cart.map(x=>`‚Ä¢ ${x.name}`).join('<br>') + `<br>–°—Ä–æ–∫: ${state.months}–º`;
  $('#co-items').innerHTML = list;
  const total = subtotal();
  const wantATM = parseInt($('#use-atm').value||'0',10)||0;
  const clamp = clampATMdesired(total, wantATM, state.atm_balance);
  $('#co-sum').textContent = String(total);
  $('#co-note').textContent = `–ó–∞–ø—Ä–æ—à–µ–Ω–æ —Å–ø–∏—Å–∞—Ç—å ATM: ${clamp} (–æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —Ä–µ—à–∞–µ—Ç –±—ç–∫–µ–Ω–¥)`;
  openModal('#modal-checkout');
}
function sendOrder(){
  const items = state.cart.map(x=>x.code);
  const wantATM = parseInt($('#use-atm').value||'0',10)||0;
  const total = subtotal();
  const clamp = clampATMdesired(total, wantATM, state.atm_balance);
  sendData({action:'checkout', items, months:state.months, use_atm:clamp, amount_eur: total});
  demoAfterOrder('EUR', {items, months:state.months, use_atm:clamp, amount_eur: total});
  closeModal('#modal-checkout');
  clearCart();
}

/* ====== Crypto Checkout ====== */
let lastCrypto = {addr:'', memo:'', chain:'BEP20'};
function openCrypto(){
  if(!state.cart.length) return toast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
  $('#cp-sum').textContent = String(subtotal());
  $('#cp-details').style.display='none';
  openModal('#modal-crypto');
}
function makeCryptoInvoice(){
  const chain = $('#cp-chain').value;
  const total = subtotal();
  const wantATM = parseInt($('#use-atm').value||'0',10)||0;
  const clamp = clampATMdesired(total, wantATM, state.atm_balance);
  const items = state.cart.map(x=>x.code);
  sendData({action:'crypto_checkout', chain, items, months:state.months, use_atm: clamp, amount_eur: total});

  const addr = CRYPTO_ADDR[chain] || '‚Äî';
  lastCrypto = {addr, memo:'‚Äî', chain};
  $('#cp-addr').textContent = addr;
  $('#cp-memo').textContent = '‚Äî';
  // QR: –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∫–æ–¥–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ –∞–¥—Ä–µ—Å (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å amount –≤ –±—É–¥—É—â–µ–º)
  drawSimpleQR(addr, document.getElementById('cp-qr'));
  $('#cp-details').style.display='block';

  demoAfterOrder('USDT', {items, months:state.months, use_atm:clamp, amount_eur: total});
}
function copyText(txt){
  navigator.clipboard?.writeText(txt); toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
}
function markPaid(){
  sendData({action:'mark_paid'});
  demoMarkPaid();
  closeModal('#modal-crypto');
  clearCart();
}

/* ====== Mini QR (fallback, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π, –Ω–µ–±–æ–ª—å—à–æ–π) ======
   –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –º–∞–ª–µ–Ω—å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –∫—Ä–∞—Å–∏–≤–æ,
   –ø–æ—ç—Ç–æ–º—É —Å–¥–µ–ª–∞–µ–º —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–π QR imitator: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞.
   –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å lib (–Ω–∞–ø—Ä–∏–º–µ—Ä, qrcodejs).
   –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ç—ã –º–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å drawSimpleQR –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é lib.
*/
function drawSimpleQR(text, canvas){
  const ctx = canvas.getContext('2d');
  const size = canvas.width;
  ctx.fillStyle = '#fff'; ctx.fillRect(0,0,size,size);
  // —Ö–µ—à:
  let h=0; for(let i=0;i<text.length;i++){ h = (h*31 + text.charCodeAt(i))>>>0; }
  const N = 25; // 25x25 –ø—Å–µ–≤–¥–æ –º–∞—Ç—Ä–∏—Ü–∞
  const cell = Math.floor(size/N);
  // finder patterns
  function finder(x,y){
    ctx.fillStyle='#000'; ctx.fillRect(x,y,7*cell,7*cell);
    ctx.fillStyle='#fff'; ctx.fillRect(x+cell,y+cell,5*cell,5*cell);
    ctx.fillStyle='#000'; ctx.fillRect(x+2*cell,y+2*cell,3*cell,3*cell);
  }
  finder(0,0); finder((N-7)*cell,0); finder(0,(N-7)*cell);
  // random-like fill based on hash
  for(let r=0;r<N;r++){
    for(let c=0;c<N;c++){
      if((r<7&&c<7)||(r<7&&c>=N-7)||(r>=N-7&&c<7)) continue;
      h = (h ^ (r*1103515245 + c*12345))>>>0;
      if(h & 1){ ctx.fillStyle='#000'; ctx.fillRect(c*cell, r*cell, cell-1, cell-1); }
    }
  }
}

/* ====== Modals ====== */
function openModal(sel){ document.querySelector(sel).classList.add('show'); }
function closeModal(sel){ document.querySelector(sel).classList.remove('show'); }

/* ====== Offline demo order flow ====== */
function demoCreateOrder(kind, obj){
  const items = obj.items || state.cart.map(x=>x.code);
  const o = {
    id: (state.orders.at(-1)?.id || 0) + 1,
    ts: Date.now(),
    items,
    months: obj.months || state.months,
    use_atm: obj.use_atm || 0,
    amount_eur: obj.amount_eur || subtotal(),
    status: 'pending',
    pay: kind
  };
  state.orders.push(o); saveJSON('orders', state.orders);
  renderOrders(); renderAdmin();
}
function demoAfterOrder(kind, obj){
  // –ø—Ä–æ—Å—Ç–æ —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
  if(!state.orders.length) demoCreateOrder(kind, obj);
  renderOrders(); renderAdmin();
}
function demoMarkPaid(){
  const last = state.orders.at(-1);
  if(last){ last.status='paid'; saveJSON('orders', state.orders); renderOrders(); renderAdmin(); toast('–û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ—á–µ–Ω–∞ (–¥–µ–º–æ)'); }
}

/* ====== Event delegation (–¥–µ–ª–∞–µ—Ç –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏) ====== */
document.addEventListener('click', (e)=>{
  const t = e.target;
  const btn = t.closest('.btn'); if(btn) ripple(e);

  const tabBtn = t.closest('.tab');
  if(tabBtn){
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    tabBtn.classList.add('active');
    const name = tabBtn.dataset.tab;
    document.querySelectorAll('section[id^="tab-"], #tab-admin').forEach(s=>{
      if(s.id==='tab-admin'){
        s.hidden = !(name==='admin' && isAdmin());
      }else{
        s.hidden = (s.id !== 'tab-'+name);
      }
    });
    if(name==='orders') renderOrders();
    if(name==='tasks') renderTasks();
    if(name==='admin'){ renderAdmin(); }
  }

  const cmdEl = t.closest('[data-cmd]');
  if(!cmdEl) return;
  const cmd = cmdEl.dataset.cmd;
  switch(cmd){
    case 'home': toast('CRYPTOATM.TECH'); break;
    case 'profile': toast('–ü—Ä–æ—Ñ–∏–ª—å —Å–∫–æ—Ä–æ ‚ú®'); break;
    case 'balance': sendData({action:'balance'}); break;
    case 'admin-tab':
      if(isAdmin()){
        document.querySelector('[data-tab="admin"]').click();
      }else{
        toast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');
      }
      break;

    case 'info': {
      const code = cmdEl.dataset.code;
      const it = CATALOG.find(x=>x.code===code);
      if(it) toast(`${it.name}\n\n${it.desc||''}\n‚Ç¨${it.eur}/–º–µ—Å`);
      break;
    }
    case 'add': addToCart(cmdEl.dataset.code); break;
    case 'remove': removeFromCart(cmdEl.dataset.code); break;
    case 'clear': clearCart(); break;
    case 'checkout': openCheckout(); break;
    case 'copy-ref': {
      const code = 'REF'+(state.user.id||0);
      navigator.clipboard?.writeText(code); toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: '+code);
      break;
    }
    case 'bind-ref': {
      const code = ($('#ref-code').value||'').trim();
      if(!code) return toast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥');
      sendData({action:'ref_bind', code});
      break;
    }
    case 'copy-info': openModal('#modal-copy'); break;
    case 'add-copy': addToCart('COPY_TRADE'); closeModal('#modal-copy'); break;
    case 'send-order': sendOrder(); break;
    case 'open-crypto': openCrypto(); break;
    case 'cp-make': makeCryptoInvoice(); break;
    case 'cp-copy': copyText($('#cp-addr').textContent||''); break;
    case 'cp-copy-m': copyText($('#cp-memo').textContent||''); break;
    case 'cp-paid': markPaid(); break;
    case 'cp-help': toast('–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ —á–∞—Ç ‚Äî –ø–æ–º–æ–∂–µ–º'); break;
    case 'task': {
      const id = parseInt(cmdEl.dataset.id,10);
      const proof = (document.querySelector(`[data-proof="${id}"]`)?.value||'').trim();
      if(!proof) return toast('–î–æ–±–∞–≤—å—Ç–µ –ø—Ä—É—Ñ');
      sendData({action:'task_submit', task_id:id, proof});
      document.querySelector(`[data-proof="${id}"]`).value='';
      toast('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é');
      break;
    }
    case 'admin-refresh':
      sendData({action:'admin_pull'});
      toast('–ó–∞–ø—Ä–æ—Å–∏–ª –¥–∞–Ω–Ω—ã–µ —É –±—ç–∫–∞');
      break;
  }
});

/* ====== Inputs ====== */
$('#duration').addEventListener('change', renderCart);
$('#use-atm').addEventListener('input', ()=>{
  const total = subtotal();
  const want = parseInt($('#use-atm').value||'0',10)||0;
  const clamp = clampATMdesired(total, want, state.atm_balance);
  if(want !== clamp) $('#use-atm').value = clamp;
});

/* ====== Boot ====== */
function boot(){
  $('#u-name').textContent = '@'+state.user.name;
  $('#my-ref').textContent = 'REF'+(state.user.id||0);
  $('#u-atm').textContent = String(state.atm_balance);
  renderCatalog(); renderCart(); renderOrders(); renderAdmin();
}
boot();
</script>
</body>
</html>
