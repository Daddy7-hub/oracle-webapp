<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"/>
  <title>Welcome Hub ‚Äî MiniApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#0c0f1a;--card:#111735;--line:rgba(255,255,255,.08);--txt:#eef1ff;--muted:#a9b6ff;--ok:#38d39f;--r:16px;}
    *{box-sizing:border-box}body{margin:0;background:radial-gradient(1000px 700px at 120% -20%,#1a2350 0,#0c0f1a 55%) fixed,#0c0f1a;color:var(--txt);font:16px/1.45 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .app{max-width:980px;margin:0 auto;padding:12px 12px 84px}
    .header{display:flex;justify-content:space-between;align-items:center;margin:8px 0 12px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:conic-gradient(from 200deg,#74f1d1,#7aa2ff,#74f1d1);color:#0b0f1c;font-weight:900}
    .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px}
    .tabs{position:fixed;left:0;right:0;bottom:0;display:grid;grid-template-columns:repeat(6,1fr);gap:8px;padding:8px;background:linear-gradient(180deg,rgba(12,15,26,.2),rgba(12,15,26,.9));backdrop-filter:blur(8px);border-top:1px solid var(--line)}
    .tab{border:1px solid var(--line);background:#0f1430;color:var(--txt);border-radius:14px;padding:8px 4px;font-size:12px;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer}
    .tab.active{outline:2px solid rgba(122,162,255,.5)}
    .card{background:linear-gradient(135deg,#131a42,#111735);border:1px solid var(--line);border-radius:var(--r);padding:14px;margin:12px 0}
    .grid{display:grid;gap:12px}.grid--2{grid-template-columns:repeat(2,1fr)}.grid--3{grid-template-columns:repeat(3,1fr)}@media(max-width:820px){.grid--2,.grid--3{grid-template-columns:1fr}}
    .label{color:var(--muted);font-size:12px;margin-bottom:4px;display:block}
    input,select,textarea{width:100%;background:#0e1436;border:1px solid var(--line);color:var(--txt);border-radius:12px;padding:10px 12px;outline:none}
    textarea{resize:vertical}
    .btn{border:1px solid var(--line);background:linear-gradient(135deg,#1a2458,#131c40);color:var(--txt);border-radius:14px;padding:10px 12px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px}
    .btn--ok{background:linear-gradient(135deg,#1a4f3a,#153b2c);border-color:rgba(56,211,159,.3)}
    .btn--pay{background:linear-gradient(135deg,#24307a,#1b245a);border-color:rgba(122,162,255,.3)}
    .muted{color:var(--muted);font-size:12px}
    .shop{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .pack{border:1px solid var(--line);background:#0f1430;border-radius:14px;padding:12px;text-align:center}
    .stars{color:#ffe27a}
    .preview{white-space:pre-wrap;background:#0e1436;border:1px dashed var(--line);border-radius:14px;padding:12px;color:#bcd}
    .tap{margin:10px 0;display:grid;place-items:center;aspect-ratio:1/1;border-radius:18px;border:1px solid var(--line);background:linear-gradient(135deg,#141c42,#0f1635);user-select:none;cursor:pointer}
    .tap__score{font-size:42px;font-weight:900}
    .task{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);background:#0f1430;border-radius:12px;padding:10px;margin-bottom:10px}
    .task.done{opacity:.6}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo">H</div>
        <div>
          <div style="font-weight:800">Welcome Hub</div>
          <div class="muted" id="env">‚Ä¶</div>
        </div>
      </div>
      <div class="chip" id="subChip">–ø–æ–¥–ø–∏—Å–∫–∞: ‚Äî</div>
    </div>

    <main id="root"></main>

    <nav class="tabs">
      <button class="tab" data-route="plans">üí≥<b>–¢–∞—Ä–∏—Ñ—ã</b></button>
      <button class="tab" data-route="subscribe">üîê<b>–ü–æ–¥–ø–∏—Å–∫–∞</b></button>
      <button class="tab" data-route="tokens">‚≠ê<b>–¢–æ–∫–µ–Ω—ã</b></button>
      <button class="tab" data-route="clicker">üïπÔ∏è<b>–ö–ª–∏–∫–µ—Ä</b></button>
      <button class="tab" data-route="quests">üéØ<b>–ó–∞–¥–∞–Ω–∏—è</b></button>
      <button class="tab" data-route="profile">üë§<b>–ü—Ä–æ—Ñ–∏–ª—å</b></button>
    </nav>
  </div>

  <template id="tpl-plans">
    <section class="card">
      <h3>–¢–∞—Ä–∏—Ñ—ã –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h3>
      <div class="grid grid--3">
        <div class="card">
          <b>Free</b><br/><span class="muted">–î–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É, –±–∞–∑–æ–≤—ã–π FAQ</span>
        </div>
        <div class="card">
          <b>Pro</b><br/><span class="muted">–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã, –∫–≤–µ—Å—Ç—ã</span>
        </div>
        <div class="card">
          <b>VIP</b><br/><span class="muted">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Å–æ–∑–≤–æ–Ω—ã, –∑–∞–∫—Ä—ã—Ç—ã–µ –∏–Ω—Å–∞–π–¥—ã</span>
        </div>
      </div>
      <div class="muted">–û–ø–ª–∞—Ç–∞ ‚Äî —á–µ—Ä–µ–∑ Telegram Stars –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ü–æ–¥–ø–∏—Å–∫–∞¬ª.</div>
    </section>
  </template>

  <template id="tpl-subscribe">
    <section class="card">
      <h3>–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</h3>
      <div class="grid grid--2">
        <div class="pack">
          <b>Pro / 30 –¥–Ω–µ–π</b>
          <div class="stars">249 ‚≠ê</div>
          <button class="btn btn--pay" data-product="sub:month">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="pack">
          <b>Pro / 90 –¥–Ω–µ–π</b>
          <div class="stars">649 ‚≠ê</div>
          <button class="btn btn--pay" data-product="sub:quarter">–ö—É–ø–∏—Ç—å</button>
        </div>
      </div>
      <p class="muted">–ù–∞–∂–º–∏—Ç–µ ¬´–ö—É–ø–∏—Ç—å¬ª ‚Äî –º—ã –æ—Ç–∫—Ä–æ–µ–º –ø–ª–∞—Ç—ë–∂ –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º.</p>
      <div id="previewSub" class="preview" style="display:none"></div>
    </section>
  </template>

  <template id="tpl-tokens">
    <section class="card">
      <h3>–ö—É–ø–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–æ–∫–µ–Ω—ã</h3>
      <div class="shop">
        <div class="pack">
          <b>200 —Ç–æ–∫–µ–Ω–æ–≤</b>
          <div class="stars">50 ‚≠ê</div>
          <button class="btn btn--pay" data-product="tokens:200">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="pack">
          <b>1200 —Ç–æ–∫–µ–Ω–æ–≤</b>
          <div class="stars">240 ‚≠ê</div>
          <button class="btn btn--pay" data-product="tokens:1200">–ö—É–ø–∏—Ç—å</button>
        </div>
        <div class="pack">
          <b>3000 —Ç–æ–∫–µ–Ω–æ–≤</b>
          <div class="stars">450 ‚≠ê</div>
          <button class="btn btn--pay" data-product="tokens:3000">–ö—É–ø–∏—Ç—å</button>
        </div>
      </div>
      <div id="previewTok" class="preview" style="display:none"></div>
    </section>
  </template>

  <template id="tpl-clicker">
    <section class="card">
      <h3>–ö–ª–∏–∫–µ—Ä</h3>
      <div class="muted">–ö–ª–∏–∫–∞–π ‚Äî –∫–æ–ø–∏ –æ—á–∫–∏. –í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è ‚Äî –ø–æ–ª—É—á–∞–π —Ç–æ–∫–µ–Ω—ã –∏ –±—É—Å—Ç—ã.</div>
      <div class="tap" id="tap">
        <div class="muted">–æ—á–∫–∏</div>
        <div id="score" class="tap__score">0</div>
      </div>
      <div class="grid grid--2">
        <button class="btn" id="boostEnergy">‚ö° –≠–Ω–µ—Ä–≥–∏—è +50</button>
        <button class="btn" id="boostMult">‚¨ÜÔ∏è –ú–Ω–æ–∂–∏—Ç–µ–ª—å +0.1</button>
      </div>
    </section>
  </template>

  <template id="tpl-quests">
    <section class="card">
      <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
      <div id="tasks"></div>
    </section>
  </template>

  <template id="tpl-profile">
    <section class="card">
      <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
      <div class="grid grid--3">
        <div>
          <label class="label">–ò–º—è</label>
          <input type="text" id="name" placeholder="–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"/>
        </div>
        <div>
          <label class="label">–¢–µ–º–∞</label>
          <select id="topic">
            <option value="career">–ö–∞—Ä—å–µ—Ä–∞</option>
            <option value="love">–õ—é–±–æ–≤—å</option>
            <option value="finance">–§–∏–Ω–∞–Ω—Å—ã</option>
            <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ</option>
            <option value="overall" selected>–û–±—â–µ–µ</option>
          </select>
        </div>
        <div>
          <label class="label">–î–†</label>
          <input type="date" id="dob"/>
        </div>
      </div>
      <div style="margin-top:10px">
        <label class="label">–û —Å–µ–±–µ</label>
        <textarea id="bio" rows="3"></textarea>
      </div>
      <div class="grid grid--2" style="margin-top:12px">
        <button class="btn btn--ok" id="save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn" id="status">üìä –°—Ç–∞—Ç—É—Å</button>
      </div>
      <div id="previewProfile" class="preview" style="display:none"></div>
    </section>
  </template>

  <script type="module">
    const tg = window.Telegram?.WebApp || null;
    const inTG = !!(tg && tg.initDataUnsafe);
    const $root = document.getElementById('root');
    const $env = document.getElementById('env');
    const $chip = document.getElementById('subChip');

    // ===== Theme / env
    if (inTG) {
      tg.ready?.(); tg.expand?.();
      $env.textContent = 'MiniApp ‚Ä¢ Telegram';
    } else {
      $env.textContent = 'Browser preview';
    }

    // ===== Router
    document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', () => route(t.dataset.route)));
    window.addEventListener('hashchange', () => render(hash()));
    function hash(){ return (location.hash || '#plans').slice(1); }
    function route(name){ location.hash = '#'+name; }
    function T(id){ return document.getElementById(id).content.cloneNode(true); }
    render(hash());

    // ===== Local state
    const KEY='hub_v1';
    let S = load();
    function load(){ try{return {...{score:0,mult:1,energy:100,name:'',topic:'overall',dob:'',bio:''},...JSON.parse(localStorage.getItem(KEY)||'{}')}}catch(e){return {score:0,mult:1,energy:100,name:'',topic:'overall',dob:'',bio:''}}}
    function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }

    // ===== View
    function render(route){
      $root.innerHTML='';
      document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.dataset.route===route));
      if(route==='plans'){ $root.appendChild(T('tpl-plans')); return; }
      if(route==='subscribe'){ renderSubscribe(); return; }
      if(route==='tokens'){ renderTokens(); return; }
      if(route==='clicker'){ renderClicker(); return; }
      if(route==='quests'){ renderQuests(); return; }
      if(route==='profile'){ renderProfile(); return; }
      $root.appendChild(T('tpl-plans'));
    }

    // ===== Subscribe
    function renderSubscribe(){
      const n=T('tpl-subscribe'); $root.appendChild(n);
      $root.querySelectorAll('[data-product]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const product = b.dataset.product; // sub:month | sub:quarter
          send({action:'buy', product}, '#previewSub');
        });
      });
    }

    // ===== Tokens
    function renderTokens(){
      const n=T('tpl-tokens'); $root.appendChild(n);
      $root.querySelectorAll('[data-product]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const product = b.dataset.product; // tokens:200|1200|3000
          send({action:'buy', product}, '#previewTok');
        });
      });
    }

    // ===== Clicker
    function renderClicker(){
      const n=T('tpl-clicker'); $root.appendChild(n);
      const tap = document.getElementById('tap');
      const score = document.getElementById('score');
      const upd = ()=> score.textContent = Math.floor(S.score);
      upd();
      tap.addEventListener('click', ()=>{
        if (S.energy <= 0){ toast('–≠–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ'); return; }
        S.energy--; S.score += 1 * (S.mult||1); save(); upd();
        if (S.score >= 100 && !localStorage.getItem('q_tap100')){
          localStorage.setItem('q_tap100', '1');
          send({action:'quest', id:'tap100', claim:true});
        }
      });
      document.getElementById('boostEnergy').onclick = ()=> { S.energy = Math.min(100, S.energy + 50); save(); toast('–≠–Ω–µ—Ä–≥–∏—è +50'); };
      document.getElementById('boostMult').onclick = ()=> { S.mult = +(S.mult + 0.1).toFixed(1); save(); toast('–ú–Ω–æ–∂–∏—Ç–µ–ª—å +0.1'); };
    }

    // ===== Quests
    function renderQuests(){
      const n=T('tpl-quests'); $root.appendChild(n);
      const $tasks = document.getElementById('tasks');
      const tasks = [
        {id:'daily', t:'–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å', r:'+1 –¥–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏ÊäΩ –∏–ª–∏ +50 —Ç–æ–∫–µ–Ω–æ–≤', done: !!localStorage.getItem('q_daily')},
        {id:'tap100', t:'–ù–∞–∫–ª–∏–∫–∞–π 100 –æ—á–∫–æ–≤', r:'–≠–Ω–µ—Ä–≥–∏—è +50', done: !!localStorage.getItem('q_tap100')},
      ];
      tasks.forEach(q=>{
        const row=document.createElement('div'); row.className='task'+(q.done?' done':'');
        const left=document.createElement('div'); left.innerHTML = `<b>${q.t}</b><div class="muted">${q.r}</div>`;
        const right=document.createElement('div');
        const btn=document.createElement('button'); btn.className='btn'; btn.textContent=q.done?'–ü–æ–ª—É—á–µ–Ω–æ':'–ó–∞–±—Ä–∞—Ç—å';
        btn.disabled=q.done;
        btn.onclick=()=>{ if(q.done) return; localStorage.setItem('q_'+q.id,'1'); send({action:'quest', id:q.id, claim:true}); render('quests'); };
        right.appendChild(btn);
        row.appendChild(left); row.appendChild(right);
        $tasks.appendChild(row);
      });
    }

    // ===== Profile
    function renderProfile(){
      const n=T('tpl-profile'); $root.appendChild(n);
      const name = document.getElementById('name'),
            topic= document.getElementById('topic'),
            dob  = document.getElementById('dob'),
            bio  = document.getElementById('bio');

      name.value = S.name||''; topic.value=S.topic||'overall'; dob.value=S.dob||''; bio.value=S.bio||'';

      document.getElementById('save').onclick = ()=>{
        S.name=name.value.trim(); S.topic=topic.value; S.dob=dob.value; S.bio=bio.value.trim(); save();
        toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
      };
      document.getElementById('status').onclick = ()=>{
        send({action:'status'});
      };
    }

    // ===== Helpers
    function toast(msg){ if (inTG) tg.showPopup?.({message:msg, buttons:[{type:'ok'}]}); else console.log(msg); }
    function send(obj, previewSel){
      const payload = JSON.stringify(obj);
      if (inTG && tg.sendData){
        tg.sendData(payload);
        tg.HapticFeedback?.impactOccurred?.('medium');
      } else {
        if (previewSel){
          const box = document.querySelector(previewSel);
          if (box){ box.style.display='block'; box.textContent = payload; }
        }
        console.log('preview send', obj);
      }
    }

    // –æ–±–Ω–æ–≤–ª—è–ª–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–∫—Ä–∞—Å–∏–≤—ã–π —á–∏–ø —Å–≤–µ—Ä—Ö—É) ‚Äî —Ñ—Ä–æ–Ω—Ç —Å–∞–º –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –¥–∞—Ç—É,
    // –ø–æ—ç—Ç–æ–º—É —á–∏–ø –ø—Ä–æ—Å—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π, –∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∫–Ω–æ–ø–∫–æ–π –≤ ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª.
    $chip.textContent = '–ø–æ–¥–ø–∏—Å–∫–∞: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
  </script>
</body>
</html>
