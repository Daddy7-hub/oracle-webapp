<!doctype html>
<html lang="ru" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oracle Mini App</title>

  <!-- Tailwind (Play CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // –¥–∏–Ω–∞–º–∏–∫–∞ –ø–æ–¥ —Ç–µ–º—É Telegram
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: "rgb(var(--tg-theme-bg-color, 248 249 250) / <alpha-value>)",
            text: "rgb(var(--tg-theme-text-color, 33 37 41) / <alpha-value>)",
            hint: "rgb(var(--tg-theme-hint-color, 108 117 125) / <alpha-value>)",
            link: "rgb(var(--tg-theme-link-color, 13 110 253) / <alpha-value>)",
            btn: "rgb(var(--tg-theme-button-color, 13 110 253) / <alpha-value>)",
            btnText: "rgb(var(--tg-theme-button-text-color, 255 255 255) / <alpha-value>)"
          },
          boxShadow: {
            soft: "0 10px 25px rgba(0,0,0,.06)"
          },
          borderRadius: {
            '2xl': '1rem'
          }
        }
      }
    }
  </script>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="h-full bg-bg text-text">
  <div class="max-w-md mx-auto p-4 space-y-4">
    <header class="text-center space-y-1">
      <h1 class="text-2xl font-semibold">üîÆ –û—Ä–∞–∫—É–ª</h1>
      <p class="text-sm text-hint">–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –°—Ñ–æ—Ä–º–∏—Ä—É–π –∞–Ω–∫–µ—Ç—É –∏ –ø–æ–ª—É—á–∏ —á—Ç–µ–Ω–∏–µ.</p>
    </header>

    <section class="bg-white/60 dark:bg-white/5 backdrop-blur rounded-2xl p-4 shadow-soft space-y-4">
      <div>
        <label class="block text-sm mb-1">–¢–µ–º–∞</label>
        <select id="topic" class="w-full rounded-xl border border-gray-300/40 bg-white/80 dark:bg-white/10 px-3 py-2">
          <option value="career">–ö–∞—Ä—å–µ—Ä–∞</option>
          <option value="love">–õ—é–±–æ–≤—å</option>
          <option value="finance">–§–∏–Ω–∞–Ω—Å—ã</option>
          <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ</option>
          <option value="overall" selected>–û–±—â–µ–µ</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
          <input id="dob" type="date" class="w-full rounded-xl border border-gray-300/40 bg-white/80 dark:bg-white/10 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm mb-1">–ü–æ–ª</label>
          <select id="gender" class="w-full rounded-xl border border-gray-300/40 bg-white/80 dark:bg-white/10 px-3 py-2">
            <option value="">‚Äî</option>
            <option value="male">–ú</option>
            <option value="female">–ñ</option>
            <option value="other">–î—Ä—É–≥–æ–π</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block text-sm mb-1">–ö–æ–Ω—Ç–µ–∫—Å—Ç / –≤–æ–ø—Ä–æ—Å (1‚Äì2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)</label>
        <textarea id="context" rows="4" class="w-full rounded-xl border border-gray-300/40 bg-white/80 dark:bg-white/10 px-3 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–º–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã, –ø–µ—Ä–µ–µ–∑–¥, –æ—Ç–Ω–æ—à–µ–Ω–∏—è..."></textarea>
      </div>

      <div class="flex items-center justify-between text-sm text-hint">
        <span>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—ë–º–Ω—É—é —Ç–µ–º—É TG</span>
        <a class="text-link" href="#" id="fill-demo">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ–º–æ</a>
      </div>
    </section>

    <section class="grid grid-cols-1 gap-3">
      <button id="btn-mini" class="w-full rounded-2xl bg-btn text-btnText py-3 font-medium">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–Ω–∏-—á—Ç–µ–Ω–∏–µ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
      <button id="btn-deep" class="w-full rounded-2xl bg-btn/90 hover:bg-btn text-btnText py-3 font-medium">–ì–ª—É–±–æ–∫–æ–µ —á—Ç–µ–Ω–∏–µ (1 –∫—Ä–µ–¥–∏—Ç)</button>
      <button id="btn-pay" class="w-full rounded-2xl border border-btn/30 text-btn py-3 font-medium bg-white/60 dark:bg-white/0">–ö—É–ø–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –∑–∞ ‚≠ê</button>
    </section>

    <section class="bg-white/60 dark:bg-white/5 backdrop-blur rounded-2xl p-4">
      <h2 class="font-medium mb-2">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞</h2>
      <pre id="preview" class="whitespace-pre-wrap text-sm text-hint"></pre>
    </section>

    <footer class="text-center text-xs text-hint">
      ‚ö†Ô∏è –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å. –ù–µ –º–µ–¥/—é—Ä/—Ñ–∏–Ω —Å–æ–≤–µ—Ç.
    </footer>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.setHeaderColor("bg_color");
      tg.setBackgroundColor("bg_color");
      tg.MainButton.hide();
    }

    const $ = (id) => document.getElementById(id);
    const fields = ["topic","dob","gender","context"];

    function readForm() {
      return {
        topic:   $("topic").value || "overall",
        dob:     $("dob").value || "",
        gender:  $("gender").value || "",
        context: ($("context").value || "").trim().slice(0, 500)
      };
    }

    function validateForm(data, strict=false) {
      // –ú–∏–Ω–∏ —á—Ç–µ–Ω–∏–µ ‚Äî –≤—Å—ë –æ–∫ –¥–∞–∂–µ –±–µ–∑ –î–†/–ø–æ–ª–∞.
      // –î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ ‚Äî –ø–æ–ø—Ä–æ—Å–∏–º —Ö–æ—Ç—è –±—ã —Ç–µ–º—É + –æ–¥–∏–Ω –∏–∑ (–î–†, –ø–æ–ª, –∫–æ–Ω—Ç–µ–∫—Å—Ç).
      if (!strict) return true;
      if (!data.topic) return false;
      const hasAny = !!(data.dob || data.gender || data.context);
      return hasAny;
    }

    function updatePreview() {
      const d = readForm();
      const lines = [
        "–¢–µ–º–∞: " + d.topic,
        "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: " + (d.dob || "‚Äî"),
        "–ü–æ–ª: " + (d.gender || "‚Äî"),
        "–ö–æ–Ω—Ç–µ–∫—Å—Ç: " + (d.context || "‚Äî")
      ];
      $("preview").textContent = lines.join("\n");
    }

    $("fill-demo").addEventListener("click", (e)=>{
      e.preventDefault();
      $("topic").value = "career";
      $("dob").value = "1994-01-07";
      $("gender").value = "female";
      $("context").value = "–ü–µ—Ä–µ–µ–∑–¥ –∏ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –ø–µ—Ä–µ–∂–∏–≤–∞—é –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–∞.";
      updatePreview();
    });

    fields.forEach(id => $(id).addEventListener("input", updatePreview));
    updatePreview();

    function sendAction(action, mode) {
      const data = readForm();
      if (action === "gen" && mode === "deep" && !validateForm(data, true)) {
        return alert("–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —á—Ç–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –ø–æ–ª–µ–π: –î–†, –ø–æ–ª –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç.");
      }
      const payload = JSON.stringify({ action, mode, ...data });
      if (tg) tg.sendData(payload);
      else alert("–û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –∫–æ–º–∞–Ω–¥–∞ /app");
    }

    $("btn-mini").addEventListener("click", ()=>sendAction("gen","mini"));
    $("btn-deep").addEventListener("click", ()=>sendAction("gen","deep"));
    $("btn-pay").addEventListener("click", ()=>sendAction("pay", null));
  </script>
</body>
</html>
